{"version":3,"sources":["Components.js"],"names":["define","langx","$","Vvveb","tmpl","inputs","jQuery","Components","base_sort","_components","_nodesLookup","_attributesLookup","_classesLookup","_classesRegexLookup","componentPropertiesElement","componentPropertiesDefaultSection","get","type","this","add","data","nodes","i","attributes","constructor","Array","classes","classesRegex","extend","inheritType","newData","inheritData","properties","merge","sort","a","b","matchNode","node","component","tagName","length","attr","name","value","j","split","regex","regexObj","RegExp","exec","toLowerCase","render","defaultSection","componentsPanelSections","each","sectionName","dataset","section","find","preservePropertySections","html","append","key","header","beforeInit","Builder","selectedEl","fn","property","input","on","event","element","child","parent","onChange","htmlAttr","oldValue","validValues","removeClass","join","addClass","StyleManager","setStyle","ContentManager","setHtml","Undo","addMutation","target","attributeName","newValue","selectNode","nodeElement","group","inputtype","init","setValue","getStyle","getHtml","filter","el","indexOf","propertySection","SectionInput","row","afterInit"],"mappings":"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","file":"../Components.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-jquery\",\r\n\t\"./Vvveb\",\r\n\t\"./tmpl\",\r\n\t\"./inputs\"\r\n],function(langx,$,Vvveb,tmpl,inputs){\r\n\tvar jQuery = $;\r\n\r\n\t\r\n\treturn Vvveb.Components = {\r\n    \tbase_sort : 100,//start sorting for base component from 100 to allow extended properties to be first\r\n\t\t\r\n\t\t_components: {},\r\n\t\t\r\n\t\t_nodesLookup: {},\r\n\t\t\r\n\t\t_attributesLookup: {},\r\n\r\n\t\t_classesLookup: {},\r\n\t\t\r\n\t\t_classesRegexLookup: {},\r\n\t\t\r\n\t\tcomponentPropertiesElement: \"#right-panel .component-properties\",\r\n\r\n\t\tcomponentPropertiesDefaultSection: \"content\",\r\n\r\n\t\tget: function(type) {\r\n\t\t\treturn this._components[type];\r\n\t\t},\r\n\r\n\t\tadd: function(type, data) {\r\n\t\t\tdata.type = type;\r\n\t\t\t\r\n\t\t\tthis._components[type] = data;\r\n\t\t\t\r\n\t\t\tif (data.nodes) \r\n\t\t\t{\r\n\t\t\t\tfor (var i in data.nodes)\r\n\t\t\t\t{\t\r\n\t\t\t\t\tthis._nodesLookup[ data.nodes[i] ] = data;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (data.attributes) \r\n\t\t\t{\r\n\t\t\t\tif (data.attributes.constructor === Array)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (var i in data.attributes)\r\n\t\t\t\t\t{\t\r\n\t\t\t\t\t\tthis._attributesLookup[ data.attributes[i] ] = data;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (var i in data.attributes)\r\n\t\t\t\t\t{\t\r\n\t\t\t\t\t\tif (typeof this._attributesLookup[i] === 'undefined')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._attributesLookup[i] = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (typeof this._attributesLookup[i][ data.attributes[i] ] === 'undefined')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._attributesLookup[i][ data.attributes[i] ] = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis._attributesLookup[i][ data.attributes[i] ] = data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (data.classes) \r\n\t\t\t{\r\n\t\t\t\tfor (var i in data.classes)\r\n\t\t\t\t{\t\r\n\t\t\t\t\tthis._classesLookup[ data.classes[i] ] = data;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (data.classesRegex) \r\n\t\t\t{\r\n\t\t\t\tfor (var i in data.classesRegex)\r\n\t\t\t\t{\t\r\n\t\t\t\t\tthis._classesRegexLookup[ data.classesRegex[i] ] = data;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\textend: function(inheritType, type, data) {\r\n\t\t\t \r\n\t\t\t var newData = data;\r\n\t\t\t \r\n\t\t\t if (inheritData = this._components[inheritType])\r\n\t\t\t {\r\n\t\t\t\tnewData = $.extend(true,{}, inheritData, data);\r\n\t\t\t\tnewData.properties = $.merge( $.merge([], inheritData.properties?inheritData.properties:[]), data.properties?data.properties:[]);\r\n\t\t\t }\r\n\t\t\t \r\n\t\t\t //sort by order\r\n\t\t\t newData.properties.sort(function (a,b) \r\n\t\t\t\t{\r\n\t\t\t\t\tif (typeof a.sort  === \"undefined\") a.sort = 0;\r\n\t\t\t\t\tif (typeof b.sort  === \"undefined\") b.sort = 0;\r\n\r\n\t\t\t\t\tif (a.sort < b.sort)\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\tif (a.sort > b.sort)\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t});\r\n\t/*\t\t \r\n\t\t\tvar output = array.reduce(function(o, cur) {\r\n\r\n\t\t\t  // Get the index of the key-value pair.\r\n\t\t\t  var occurs = o.reduce(function(n, item, i) {\r\n\t\t\t\treturn (item.key === cur.key) ? i : n;\r\n\t\t\t  }, -1);\r\n\r\n\t\t\t  // If the name is found,\r\n\t\t\t  if (occurs >= 0) {\r\n\r\n\t\t\t\t// append the current value to its list of values.\r\n\t\t\t\to[occurs].value = o[occurs].value.concat(cur.value);\r\n\r\n\t\t\t  // Otherwise,\r\n\t\t\t  } else {\r\n\r\n\t\t\t\t// add the current item to o (but make sure the value is an array).\r\n\t\t\t\tvar obj = {name: cur.key, value: [cur.value]};\r\n\t\t\t\to = o.concat([obj]);\r\n\t\t\t  }\r\n\r\n\t\t\t  return o;\r\n\t\t\t}, newData.properties);\t\t \r\n\t*/\r\n\t\t\t\r\n\t\t\tthis.add(type, newData);\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\tmatchNode: function(node) {\r\n\t\t\tvar component = {};\r\n\t\t\t\r\n\t\t\tif (!node || !node.tagName) return false;\r\n\t\t\t\r\n\t\t\tif (node.attributes && node.attributes.length)\r\n\t\t\t{\r\n\t\t\t\t//search for attributes\r\n\t\t\t\tfor (var i in node.attributes)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (node.attributes[i])\r\n\t\t\t\t\t{\r\n\t\t\t\t\tattr = node.attributes[i].name;\r\n\t\t\t\t\tvalue = node.attributes[i].value;\r\n\r\n\t\t\t\t\tif (attr in this._attributesLookup) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcomponent = this._attributesLookup[ attr ];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//currently we check that is not a component by looking at name attribute\r\n\t\t\t\t\t\t//if we have a collection of objects it means that attribute value must be checked\r\n\t\t\t\t\t\tif (typeof component[\"name\"] === \"undefined\")\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (value in component)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\treturn component[value];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else \r\n\t\t\t\t\t\treturn component;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\tfor (var i in node.attributes)\r\n\t\t\t\t{\r\n\t\t\t\t\tattr = node.attributes[i].name;\r\n\t\t\t\t\tvalue = node.attributes[i].value;\r\n\t\t\t\t\t\r\n\t\t\t\t\t//check for node classes\r\n\t\t\t\t\tif (attr == \"class\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tclasses = value.split(\" \");\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor (j in classes) \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (classes[j] in this._classesLookup)\r\n\t\t\t\t\t\t\treturn this._classesLookup[ classes[j] ];\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor (regex in this._classesRegexLookup) \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tregexObj = new RegExp(regex);\r\n\t\t\t\t\t\t\tif (regexObj.exec(value)) \r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\treturn this._classesRegexLookup[ regex ];\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttagName = node.tagName.toLowerCase();\r\n\t\t\tif (tagName in this._nodesLookup) return this._nodesLookup[ tagName ];\r\n\t\t\r\n\t\t\treturn false;\r\n\t\t\t//return false;\r\n\t\t},\r\n\t\t\r\n\t\trender: function(type) {\r\n\r\n\t\t\tvar component = this._components[type];\r\n\r\n\t\t\tvar componentsPanel = jQuery(this.componentPropertiesElement);\r\n\t\t\tvar defaultSection = this.componentPropertiesDefaultSection;\r\n\t\t\tvar componentsPanelSections = {};\r\n\r\n\t\t\tjQuery(this.componentPropertiesElement + \" .tab-pane\").each(function ()\r\n\t\t\t{\r\n\t\t\t\tvar sectionName = this.dataset.section;\r\n\t\t\t\tcomponentsPanelSections[sectionName] = $(this);\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvar section = componentsPanelSections[defaultSection].find('.section[data-section=\"default\"]');\r\n\t\t\t\r\n\t\t\tif (!(Vvveb.preservePropertySections && section.length))\r\n\t\t\t{\r\n\t\t\t\tcomponentsPanelSections[defaultSection].html('').append(tmpl(\"vvveb-input-sectioninput\", {key:\"default\", header:component.name}));\r\n\t\t\t\tsection = componentsPanelSections[defaultSection].find(\".section\");\r\n\t\t\t}\r\n\r\n\t\t\tcomponentsPanelSections[defaultSection].find('[data-header=\"default\"] span').html(component.name);\r\n\t\t\tsection.html(\"\")\t\r\n\t\t\r\n\t\t\tif (component.beforeInit) component.beforeInit(Vvveb.Builder.selectedEl.get(0));\r\n\t\t\t\r\n\t\t\tvar element;\r\n\t\t\t\r\n\t\t\tvar fn = function(component, property) {\r\n\t\t\t\treturn property.input.on('propertyChange', function (event, value, input) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar element = Vvveb.Builder.selectedEl;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (property.child) element = element.find(property.child);\r\n\t\t\t\t\t\tif (property.parent) element = element.parent(property.parent);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (property.onChange)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\telement = property.onChange(element, value, input, component);\r\n\t\t\t\t\t\t}/* else */\r\n\t\t\t\t\t\tif (property.htmlAttr)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\toldValue = element.attr(property.htmlAttr);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (property.htmlAttr == \"class\" && property.validValues) \r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement.removeClass(property.validValues.join(\" \"));\r\n\t\t\t\t\t\t\t\telement = element.addClass(value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (property.htmlAttr == \"style\") \r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement = Vvveb.StyleManager.setStyle(element, property.key, value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (property.htmlAttr == \"innerHTML\") \r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement = Vvveb.ContentManager.setHtml(element, value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement = element.attr(property.htmlAttr, value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tVvveb.Undo.addMutation({type: 'attributes', \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttarget: element.get(0), \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tattributeName: property.htmlAttr, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\toldValue: oldValue, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tnewValue: element.attr(property.htmlAttr)});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (component.onChange) \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\telement = component.onChange(element, property, value, input);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (!property.child && !property.parent) Vvveb.Builder.selectNode(element);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn element;\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t};\t\t\t\r\n\t\t\r\n\t\t\tvar nodeElement = Vvveb.Builder.selectedEl;\r\n\r\n\t\t\tfor (var i in component.properties)\r\n\t\t\t{\r\n\t\t\t\tvar property = component.properties[i];\r\n\t\t\t\tvar element = nodeElement;\r\n\t\t\t\t\r\n\t\t\t\tif (property.beforeInit) property.beforeInit(element.get(0)) \r\n\t\t\t\t\r\n\t\t\t\tif (property.child) element = element.find(property.child);\r\n\t\t\t\t\r\n\t\t\t\tif (property.data) {\r\n\t\t\t\t\tproperty.data[\"key\"] = property.key;\r\n\t\t\t\t} else\r\n\t\t\t\t{\r\n\t\t\t\t\tproperty.data = {\"key\" : property.key};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof property.group  === 'undefined') property.group = null;\r\n\r\n\t\t\t\tproperty.input = property.inputtype.init(property.data);\r\n\t\t\t\t\r\n\t\t\t\tif (property.init)\r\n\t\t\t\t{\r\n\t\t\t\t\tproperty.inputtype.setValue(property.init(element.get(0)));\r\n\t\t\t\t} else if (property.htmlAttr)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (property.htmlAttr == \"style\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//value = element.css(property.key);//jquery css returns computed style\r\n\t\t\t\t\t\tvar value = Vvveb.StyleManager.getStyle(element, property.key);//getStyle returns declared style\r\n\t\t\t\t\t} else\r\n\t\t\t\t\tif (property.htmlAttr == \"innerHTML\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar value = Vvveb.ContentManager.getHtml(element);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar value = element.attr(property.htmlAttr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//if attribute is class check if one of valid values is included as class to set the select\r\n\t\t\t\t\tif (value && property.htmlAttr == \"class\" && property.validValues)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvalue = value.split(\" \").filter(function(el) {\r\n\t\t\t\t\t\t\treturn property.validValues.indexOf(el) != -1\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} \r\n\r\n\t\t\t\t\tproperty.inputtype.setValue(value);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfn(component, property);\r\n\t\t\t\t\r\n\t\t\t\tvar propertySection = defaultSection;\r\n\t\t\t\tif (property.section)\r\n\t\t\t\t{\r\n\t\t\t\t\tpropertySection = property.section;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\tif (property.inputtype == SectionInput)\r\n\t\t\t\t{\r\n\t\t\t\t\tsection = componentsPanelSections[propertySection].find('.section[data-section=\"' + property.key + '\"]');\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (Vvveb.preservePropertySections && section.length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsection.html(\"\");\r\n\t\t\t\t\t} else \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcomponentsPanelSections[propertySection].append(property.input);\r\n\t\t\t\t\t\tsection = componentsPanelSections[propertySection].find('.section[data-section=\"' + property.key + '\"]');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar row = $(tmpl('vvveb-property', property)); \r\n\t\t\t\t\trow.find('.input').append(property.input);\r\n\t\t\t\t\tsection.append(row);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (property.inputtype.afterInit)\r\n\t\t\t\t{\r\n\t\t\t\t\tproperty.inputtype.afterInit(property.input);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (component.init) component.init(Vvveb.Builder.selectedEl.get(0));\r\n\t\t}\r\n\t};\t\r\n});"]}