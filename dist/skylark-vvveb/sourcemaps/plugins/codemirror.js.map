{"version":3,"sources":["plugins/codemirror.js"],"names":["define","Vvveb","CodeMirror","CodeEditor","isActive","oldValue","doc","codemirror","init","this","fromTextArea","document","querySelector","mode","lineNumbers","autofocus","lineWrapping","theme","getDoc","on","e","v","origin","delay","Builder","setHtml","getValue","frameBody","setValue","documentFrame","value","scrollInfo","getScrollInfo","getHtml","scrollTo","left","top","destroy","element","toggle"],"mappings":";;;;;;;AAAAA,QACC,WACA,gCACA,mCACC,SAASC,EAAMC,GAChB,OAAOD,EAAME,YAEZC,UAAU,EACVC,SAAU,GACVC,KAAI,EACJC,YAAW,EAEXC,KAAM,SAASF,GA6Bd,OA3BuB,GAAnBG,KAAKF,aAERE,KAAKF,WAAaL,EAAWQ,aAAaC,SAASC,cAAc,gCAChEC,KAAM,YACNC,aAAa,EACbC,WAAW,EACXC,cAAc,EAEdC,MAAO,aAGRR,KAAKL,UAAW,EAChBK,KAAKF,WAAWW,SAASC,GAAG,SAAU,SAAUC,EAAGC,GAClC,YAAZA,EAAEC,QACNC,MAAMtB,EAAMuB,QAAQC,QAAQL,EAAEM,YAAa,QAM7CzB,EAAMuB,QAAQG,UAAUR,GAAG,oCAAqC,SAAUC,GAAKnB,EAAME,WAAWyB,SAASR,KAEzGnB,EAAMuB,QAAQK,cAAcV,GAAG,OAAQ,SAAUC,GAAKnB,EAAME,WAAWyB,aAEvEnB,KAAKL,UAAW,EAChBK,KAAKmB,WAEEnB,KAAKF,YAGbqB,SAAU,SAASE,GAClB,GAAqB,GAAjBrB,KAAKL,SACT,CACC,IAAI2B,EAAatB,KAAKF,WAAWyB,gBACjCvB,KAAKF,WAAWqB,SAAS3B,EAAMuB,QAAQS,WACvCxB,KAAKF,WAAW2B,SAASH,EAAWI,KAAMJ,EAAWK,OAIvDC,QAAS,SAASC,GAMjB7B,KAAKL,UAAW,GAGjBmC,OAAQ,WACP,GAAqB,GAAjB9B,KAAKL,SAGR,OADAK,KAAKL,UAAW,EACTK,KAAKD,OAEbC,KAAKL,UAAW,EAChBK,KAAK4B","file":"../../plugins/codemirror.js","sourcesContent":["define([\n\t\"../Vvveb\",\n\t\"skylark-codemirror/CodeMirror\",\n\t\"skylark-codemirror/mode/xml/xml\"\n],function(Vvveb,CodeMirror){\n\treturn Vvveb.CodeEditor = {\n\t\t\n\t\tisActive: false,\n\t\toldValue: '',\n\t\tdoc:false,\n\t\tcodemirror:false,\n\t\t\n\t\tinit: function(doc) {\n\n\t\t\tif (this.codemirror == false)\t\t\n\t\t\t{\n\t\t\t\tthis.codemirror = CodeMirror.fromTextArea(document.querySelector(\"#vvveb-code-editor textarea\"), {\n\t\t\t\t\tmode: 'text/html',\n\t\t\t\t\tlineNumbers: true,\n\t\t\t\t\tautofocus: true,\n\t\t\t\t\tlineWrapping: true,\n\t\t\t\t\t//viewportMargin:Infinity,\n\t\t\t\t\ttheme: 'material'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tthis.isActive = true;\n\t\t\t\tthis.codemirror.getDoc().on(\"change\", function (e, v) { \n\t\t\t\t\tif (v.origin != \"setValue\")\n\t\t\t\t\tdelay(Vvveb.Builder.setHtml(e.getValue()), 1000);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t//_self = this;\n\t\t\tVvveb.Builder.frameBody.on(\"vvveb.undo.add vvveb.undo.restore\", function (e) { Vvveb.CodeEditor.setValue(e);});\n\t\t\t//load code when a new url is loaded\n\t\t\tVvveb.Builder.documentFrame.on(\"load\", function (e) { Vvveb.CodeEditor.setValue();});\n\n\t\t\tthis.isActive = true;\n\t\t\tthis.setValue();\n\n\t\t\treturn this.codemirror;\n\t\t},\n\n\t\tsetValue: function(value) {\n\t\t\tif (this.isActive == true)\n\t\t\t{\n\t\t\t\tvar scrollInfo = this.codemirror.getScrollInfo();\n\t\t\t\tthis.codemirror.setValue(Vvveb.Builder.getHtml());\n\t\t\t\tthis.codemirror.scrollTo(scrollInfo.left, scrollInfo.top);\n\t\t\t}\n\t\t},\n\n\t\tdestroy: function(element) {\n\t\t\t/*\n\t\t\t//save memory by destroying but lose scroll on editor toggle\n\t\t\tthis.codemirror.toTextArea();\n\t\t\tthis.codemirror = false;\n\t\t\t*/ \n\t\t\tthis.isActive = false;\n\t\t},\n\n\t\ttoggle: function() {\n\t\t\tif (this.isActive != true)\n\t\t\t{\n\t\t\t\tthis.isActive = true;\n\t\t\t\treturn this.init();\n\t\t\t}\n\t\t\tthis.isActive = false;\n\t\t\tthis.destroy();\n\t\t}\n\t}\n});\n\n"]}