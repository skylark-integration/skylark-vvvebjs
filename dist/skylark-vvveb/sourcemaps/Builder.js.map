{"version":3,"sources":["Builder.js"],"names":["define","$","Vvveb","jQuery","Builder","component","dragMoveMutation","isPreview","runJsOnSetHtml","designerMode","init","url","callback","this","loadControlGroups","loadBlockGroups","selectedEl","highlightEl","initCallback","documentFrame","canvas","_loadIframe","_initDragdrop","_initBox","dragElement","componentsList","empty","item","count","each","list","type","dataset","group","ComponentsGroup","append","componentsSubList","find","i","components","componentType","Components","get","name","toLowerCase","image","css","backgroundImage","backgroundRepeat","blocksList","BlocksGroup","blocksSubList","blocks","blockType","block","Blocks","indexOf","loadUrl","hide","iframe","src","self","on","window","FrameWindow","contentWindow","FrameDocument","document","addSectionBox","highlightBox","event","Undo","undoIndex","returnValue","offset","top","frameDoc","scrollTop","left","scrollLeft","width","outerWidth","height","outerHeight","WysiwygEditor","_frameLoaded","frameHtml","frameBody","frameHead","baseUrl","_initHighlight","triggerHandler","_getElementType","el","componentName","attributes","j","length","nodeName","replace","tagName","loadNodeComponent","node","data","matchNode","defaultComponent","render","selectNode","texteditEl","destroy","removeClass","show","target","display","err","console","log","html","isElement","originalEvent","halfHeight","Math","max","halfWidth","x","clientX","y","clientY","isDragging","parent","isIE11","appendTo","prepend","prependTo","parentOffset","offsetParent","position","iconDrag","hasAttribute","border","addClass","remove","dragHtml","newElement","replaceWith","afterDrop","addMutation","parentNode","addedNodes","nextSibling","newParent","newNextSibling","edit","attr","contenteditable","spellcheckker","is","tab","preventDefault","oldParent","oldNextSibling","next","after","prev","before","clone","click","removedNodes","addSectionElement","addSectionComponent","val","$this","dragStart","dragIcon","id","z-index","elementMouseIsOver","elementFromPoint","trigger","stopPropagation","removeHelpers","keepHelperAttributes","getHtml","doc","hasDoctpe","doctype","publicId","systemId","documentElement","innerHTML","filter","setHtml","start","end","body","slice","saveAjax","fileName","startTemplateUrl","FileManager","getCurrentUrl","ajax","cache","success","error","alert","responseText","setDesignerMode"],"mappings":"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","file":"../Builder.js","sourcesContent":["define([\n\t\"skylark-jquery\",\n\t\"./Vvveb\"\n],function($,Vvveb){\n\tvar jQuery = $;\n\t\n\treturn Vvveb.Builder = {\n\n\t\tcomponent : {},\n\t\tdragMoveMutation : false,\n\t\tisPreview : false,\n\t\trunJsOnSetHtml : false,\n\t\tdesignerMode : false,\n\t\t\n\t\tinit: function(url, callback) {\n\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tself.loadControlGroups();\n\t\t\tself.loadBlockGroups();\n\t\t\t\n\t\t\tself.selectedEl = null;\n\t\t\tself.highlightEl = null;\n\t\t\tself.initCallback = callback;\n\t\t\t\n\t        self.documentFrame = $(\"#iframe-wrapper > iframe\");\n\t        self.canvas = $(\"#canvas\");\n\n\t\t\tself._loadIframe(url);\n\t\t\t\n\t\t\tself._initDragdrop();\n\t\t\t\n\t\t\tself._initBox();\n\n\t\t\tself.dragElement = null;\n\t\t},\n\t\t\n\t/* controls */    \t\n\t\tloadControlGroups : function() {\t\n\n\t\t\tvar componentsList = $(\".components-list\");\n\t\t\tcomponentsList.empty();\n\t\t\tvar item = {}, component = {};\n\t\t\tvar count = 0;\n\t\t\t\n\t\t\tcomponentsList.each(function ()\n\t\t\t{\n\t\t\t\tvar list = $(this);\n\t\t\t\tvar type = this.dataset.type;\n\t\t\t\tcount ++;\n\t\t\t\t\n\t\t\t\tfor (group in Vvveb.ComponentsGroup)\t\n\t\t\t\t{\n\t\t\t\t\tlist.append('<li class=\"header clearfix\" data-section=\"' + group + '\"  data-search=\"\"><label class=\"header\" for=\"' + type + '_comphead_' + group + count + '\">' + group + '  <div class=\"header-arrow\"></div>\\\n\t\t\t\t\t\t\t\t\t\t   </label><input class=\"header_check\" type=\"checkbox\" checked=\"true\" id=\"' + type + '_comphead_' + group + count + '\">  <ol></ol></li>');\n\n\t\t\t\t\tvar componentsSubList = list.find('li[data-section=\"' + group + '\"]  ol');\n\t\t\t\t\t\n\t\t\t\t\tcomponents = Vvveb.ComponentsGroup[ group ];\n\t\t\t\t\t\n\t\t\t\t\tfor (i in components)\n\t\t\t\t\t{\n\t\t\t\t\t\tcomponentType = components[i];\n\t\t\t\t\t\tcomponent = Vvveb.Components.get(componentType);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (component)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem = $('<li data-section=\"' + group + '\" data-drag-type=component data-type=\"' + componentType + '\" data-search=\"' + component.name.toLowerCase() + '\"><a href=\"#\">' + component.name + \"</a></li>\");\n\n\t\t\t\t\t\t\tif (component.image) {\n\n\t\t\t\t\t\t\t\titem.css({\n\t\t\t\t\t\t\t\t\tbackgroundImage: \"url(\" + 'libs/builder/' + component.image + \")\",\n\t\t\t\t\t\t\t\t\tbackgroundRepeat: \"no-repeat\"\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tcomponentsSubList.append(item)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t },\n\t\t \n\t\tloadBlockGroups : function() {\t\n\n\t\t\tvar blocksList = $(\".blocks-list\");\n\t\t\tblocksList.empty();\n\t\t\tvar item = {};\n\n\t\t\tblocksList.each(function ()\n\t\t\t{\n\n\t\t\t\tvar list = $(this);\n\t\t\t\tvar type = this.dataset.type;\n\n\t\t\t\tfor (group in Vvveb.BlocksGroup)\t\n\t\t\t\t{\n\t\t\t\t\tlist.append('<li class=\"header\" data-section=\"' + group + '\"  data-search=\"\"><label class=\"header\" for=\"' + type + '_blockhead_' + group + '\">' + group + '  <div class=\"header-arrow\"></div>\\\n\t\t\t\t\t\t\t\t\t\t   </label><input class=\"header_check\" type=\"checkbox\" checked=\"true\" id=\"' + type + '_blockhead_' + group + '\">  <ol></ol></li>');\n\n\t\t\t\t\tvar blocksSubList = list.find('li[data-section=\"' + group + '\"]  ol');\n\t\t\t\t\tblocks = Vvveb.BlocksGroup[ group ];\n\n\t\t\t\t\tfor (i in blocks)\n\t\t\t\t\t{\n\t\t\t\t\t\tblockType = blocks[i];\n\t\t\t\t\t\tblock = Vvveb.Blocks.get(blockType);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem = $('<li data-section=\"' + group + '\" data-drag-type=block data-type=\"' + blockType + '\" data-search=\"' + block.name.toLowerCase() + '\"><a href=\"#\">' + block.name + \"</a></li>\");\n\n\t\t\t\t\t\t\tif (block.image) {\n\n\t\t\t\t\t\t\t\titem.css({\n\t\t\t\t\t\t\t\t\tbackgroundImage: \"url(\" + ((block.image.indexOf('//') == -1) ? 'libs/builder/':'') + block.image + \")\",\n\t\t\t\t\t\t\t\t\tbackgroundRepeat: \"no-repeat\"\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tblocksSubList.append(item)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t },\n\t\t\n\t\tloadUrl : function(url, callback) {\t\n\t\t\tvar self = this;\n\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\n\t\t\tself.initCallback = callback;\n\t\t\tif (Vvveb.Builder.iframe.src != url) Vvveb.Builder.iframe.src = url;\n\t\t},\n\t\t\n\t/* iframe */\n\t\t_loadIframe : function(url) {\t\n\n\t\t\tvar self = this;\n\t\t\tself.iframe = this.documentFrame.get(0);\n\t\t\tself.iframe.src = url;\n\n\t\t    return this.documentFrame.on(\"load\", function() \n\t        {\n\t\t\t\t\twindow.FrameWindow = self.iframe.contentWindow;\n\t\t\t\t\twindow.FrameDocument = self.iframe.contentWindow.document;\n\t\t\t\t\tvar addSectionBox = jQuery(\"#add-section-box\"); \n\t\t\t\t\tvar highlightBox = jQuery(\"#highlight-box\").hide(); \n\t\t\t\t\t\n\n\t\t\t\t\t$(window.FrameWindow).on( \"beforeunload\", function(event) {\n\t\t\t\t\t\tif (Vvveb.Undo.undoIndex <= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar dialogText = \"You have unsaved changes\";\n\t\t\t\t\t\t\tevent.returnValue = dialogText;\n\t\t\t\t\t\t\treturn dialogText;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tjQuery(window.FrameWindow).on(\"scroll resize\", function(event) {\n\t\t\t\t\t\n\t\t\t\t\t\t\tif (self.selectedEl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar offset = self.selectedEl.offset();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tjQuery(\"#select-box\").css(\n\t\t\t\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t\t\t\t \"width\" : self.selectedEl.outerWidth(), \n\t\t\t\t\t\t\t\t\t \"height\": self.selectedEl.outerHeight(),\n\t\t\t\t\t\t\t\t\t //\"display\": \"block\"\n\t\t\t\t\t\t\t\t\t });\t\t\t\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (self.highlightEl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar offset = self.highlightEl.offset();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\thighlightBox.css(\n\t\t\t\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t\t\t\t \"width\" : self.highlightEl.outerWidth(), \n\t\t\t\t\t\t\t\t\t \"height\": self.highlightEl.outerHeight(),\n\t\t\t\t\t\t\t\t\t //\"display\": \"block\"\n\t\t\t\t\t\t\t\t\t });\t\t\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\taddSectionBox.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\tVvveb.WysiwygEditor.init(window.FrameDocument);\n\t\t\t\t\tif (self.initCallback) self.initCallback();\n\n\t                return self._frameLoaded();\n\t        });\t\t\n\t        \n\t\t},\t\n\t    \n\t    _frameLoaded : function() {\n\t\t\t\n\t\t\tvar self = Vvveb.Builder;\n\t\t\t\n\t\t\tself.frameDoc = $(window.FrameDocument);\n\t\t\tself.frameHtml = $(window.FrameDocument).find(\"html\");\n\t\t\tself.frameBody = $(window.FrameDocument).find(\"body\");\n\t\t\tself.frameHead = $(window.FrameDocument).find(\"head\");\n\t\t\t\n\t\t\t//insert editor helpers like non editable areas\n\t\t\tself.frameHead.append('<link data-vvveb-helpers href=\"' + Vvveb.baseUrl + '../../css/vvvebjs-editor-helpers.css\" rel=\"stylesheet\">');\n\n\t\t\tself._initHighlight();\n\t\t\t\n\t\t\t$(window).triggerHandler(\"vvveb.iframe.loaded\", self.frameDoc);\n\t    },\t\n\t    \n\t    _getElementType: function(el) {\n\t\t\t\n\t\t\t//search for component attribute\n\t\t\tcomponentName = '';  \n\t\t\t   \n\t\t\tif (el.attributes)\n\t\t\tfor (var j = 0; j < el.attributes.length; j++){\n\t\t\t\t\n\t\t\t  if (el.attributes[j].nodeName.indexOf('data-component') > -1)\t\n\t\t\t  {\n\t\t\t\tcomponentName = el.attributes[j].nodeName.replace('data-component-', '');\t\n\t\t\t  }\n\t\t\t}\n\t\t\t\n\t\t\tif (componentName != '') return componentName;\n\n\t\t\treturn el.tagName;\n\t\t},\n\t\t\n\t\tloadNodeComponent:  function(node) {\n\t\t\tdata = Vvveb.Components.matchNode(node);\n\t\t\tvar component;\n\t\t\t\n\t\t\tif (data) \n\t\t\t\tcomponent = data.type;\n\t\t\telse \n\t\t\t\tcomponent = Vvveb.defaultComponent;\n\t\t\t\t\n\t\t\tVvveb.Components.render(component);\n\n\t\t},\n\t\t\n\t\tselectNode:  function(node) {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (self.texteditEl && self.selectedEl.get(0) != node) \n\t\t\t{\n\t\t\t\tVvveb.WysiwygEditor.destroy(self.texteditEl);\n\t\t\t\tjQuery(\"#select-box\").removeClass(\"text-edit\").find(\"#select-actions\").show();\n\t\t\t\tself.texteditEl = null;\n\t\t\t}\n\n\t\t\tvar target = jQuery(node);\n\t\t\t\n\t\t\tif (target)\n\t\t\t{\n\t\t\t\tself.selectedEl = target;\n\n\t\t\t\ttry {\n\t\t\t\t\tvar offset = target.offset();\n\t\t\t\t\t\t\n\t\t\t\t\tjQuery(\"#select-box\").css(\n\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t \"width\" : target.outerWidth(), \n\t\t\t\t\t\t \"height\": target.outerHeight(),\n\t\t\t\t\t\t \"display\": \"block\",\n\t\t\t\t\t\t });\n\t\t\t\t} catch(err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t \n\t\t\tjQuery(\"#highlight-name\").html(this._getElementType(node));\n\t\t\t\n\t\t},\n\n\t/* iframe highlight */    \n\t    _initHighlight: function() {\n\t\t\t\n\t\t\tvar self = Vvveb.Builder;\n\t\t\t\n\t\t\tself.frameHtml.on(\"mousemove touchmove\", function(event) {\n\t\t\t\t\n\t\t\t\tif (event.target && isElement(event.target) && event.originalEvent)\n\t\t\t\t{\n\t\t\t\t\tself.highlightEl = target = jQuery(event.target);\n\t\t\t\t\tvar offset = target.offset();\n\t\t\t\t\tvar height = target.outerHeight();\n\t\t\t\t\tvar halfHeight = Math.max(height / 2, 50);\n\t\t\t\t\tvar width = target.outerWidth();\n\t\t\t\t\tvar halfWidth = Math.max(width / 2, 50);\n\t\t\t\t\t\n\t\t\t\t\tvar x = (event.clientX || event.originalEvent.clientX);\n\t\t\t\t\tvar y = (event.clientY || event.originalEvent.clientY);\n\t\t\t\t\t\n\t\t\t\t\tif (self.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parent = self.highlightEl;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (event.originalEvent)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ((offset.top  < (y - halfHeight)) || (offset.left  < (x - halfWidth)))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t if (isIE11) \n\t\t\t\t\t\t\t\t\t\tself.highlightEl.append(self.dragElement); \n\t\t\t\t\t\t\t\t\t else \n\t\t\t\t\t\t\t\t\t\tself.dragElement.appendTo(parent);\n\t\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (isIE11) \n\t\t\t\t\t\t\t\t\t self.highlightEl.prepend(self.dragElement); \n\t\t\t\t\t\t\t\t\telse \n\t\t\t\t\t\t\t\t\t\tself.dragElement.prependTo(parent);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (self.designerMode)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar parentOffset = self.dragElement.offsetParent().offset();\n\n\t\t\t\t\t\t\t\t\tself.dragElement.css({\n\t\t\t\t\t\t\t\t\t\t\"position\": \"absolute\",\n\t\t\t\t\t\t\t\t\t\t'left': x - (parentOffset.left - self.frameDoc.scrollLeft()), \n\t\t\t\t\t\t\t\t\t\t'top': y - (parentOffset.top - self.frameDoc.scrollTop()),\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!self.designerMode && self.iconDrag) self.iconDrag.css({'left': x + 275/*left panel width*/, 'top':y - 30 });\t\t\t\t\t\n\t\t\t\t\t}// else //uncomment else to disable parent highlighting when dragging\n\t\t\t\t\t{\n\t\t\t\t\t\t\n\t\t\t\t\t\tjQuery(\"#highlight-box\").css(\n\t\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t\t \"width\" : width, \n\t\t\t\t\t\t\t \"height\": height,\n\t\t\t\t\t\t\t  \"display\" : event.target.hasAttribute('contenteditable')?\"none\":\"block\",\n\t\t\t\t\t\t\t  \"border\":self.isDragging?\"1px dashed aqua\":\"\",//when dragging highlight parent with green\n\t\t\t\t\t\t\t });\n\n\t\t\t\t\t\tif (height < 50) \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tjQuery(\"#section-actions\").addClass(\"outside\");\t \n\t\t\t\t\t\t} else\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tjQuery(\"#section-actions\").removeClass(\"outside\");\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\tjQuery(\"#highlight-name\").html(self._getElementType(event.target));\n\t\t\t\t\t\tif (self.isDragging) jQuery(\"#highlight-name\").hide(); else jQuery(\"#highlight-name\").show();//hide tag name when dragging\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\tself.frameHtml.on(\"mouseup touchend\", function(event) {\n\t\t\t\tif (self.isDragging)\n\t\t\t\t{\n\t\t\t\t\tself.isDragging = false;\n\t\t\t\t\tif (self.iconDrag) self.iconDrag.remove();\n\t\t\t\t\t$(\"#component-clone\").remove();\n\n\t\t\t\t\tif (self.dragMoveMutation === false)\n\t\t\t\t\t{\t\t\t\t\n\t\t\t\t\t\tif (self.component.dragHtml) //if dragHtml is set for dragging then set real component html\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewElement = $(self.component.html);\n\t\t\t\t\t\t\tself.dragElement.replaceWith(newElement);\n\t\t\t\t\t\t\tself.dragElement = newElement;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (self.component.afterDrop) self.dragElement = self.component.afterDrop(self.dragElement);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tself.dragElement.css(\"border\", \"\");\n\t\t\t\t\t\n\t\t\t\t\tnode = self.dragElement.get(0);\n\t\t\t\t\tself.selectNode(node);\n\t\t\t\t\tself.loadNodeComponent(node);\n\n\t\t\t\t\tif (self.dragMoveMutation === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\t\t\taddedNodes: [node], \n\t\t\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tself.dragMoveMutation.newParent = node.parentNode;\n\t\t\t\t\t\tself.dragMoveMutation.newNextSibling = node.nextSibling;\n\t\t\t\t\t\t\n\t\t\t\t\t\tVvveb.Undo.addMutation(self.dragMoveMutation);\n\t\t\t\t\t\tself.dragMoveMutation = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.frameHtml.on(\"dblclick\", function(event) {\n\t\t\t\t\n\t\t\t\tif (Vvveb.Builder.isPreview == false)\n\t\t\t\t{\n\t\t\t\t\tself.texteditEl = target = jQuery(event.target);\n\n\t\t\t\t\tVvveb.WysiwygEditor.edit(self.texteditEl);\n\t\t\t\t\t\n\t\t\t\t\tself.texteditEl.attr({'contenteditable':true, 'spellcheckker':false});\n\t\t\t\t\t\n\t\t\t\t\tself.texteditEl.on(\"blur keyup paste input\", function(event) {\n\n\t\t\t\t\t\tjQuery(\"#select-box\").css({\n\t\t\t\t\t\t\t\t\"width\" : self.texteditEl.outerWidth(), \n\t\t\t\t\t\t\t\t\"height\": self.texteditEl.outerHeight()\n\t\t\t\t\t\t\t });\n\t\t\t\t\t});\t\t\n\t\t\t\t\t\n\t\t\t\t\tjQuery(\"#select-box\").addClass(\"text-edit\").find(\"#select-actions\").hide();\n\t\t\t\t\tjQuery(\"#highlight-box\").hide();\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t\tself.frameHtml.on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\tif (Vvveb.Builder.isPreview == false)\n\t\t\t\t{\n\t\t\t\t\tif (event.target)\n\t\t\t\t\t{\n\t\t\t\t\t\t//if component properties is loaded in left panel tab instead of right panel show tab\n\t\t\t\t\t\tif ($(\".component-properties-tab\").is(\":visible\"))//if properites tab is enabled/visible \n\t\t\t\t\t\t\t$('.component-properties-tab a').show().tab('show'); \n\t\t\t\t\t\t\n\t\t\t\t\t\tself.selectNode(event.target);\n\t\t\t\t\t\tself.loadNodeComponent(event.target);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\t\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t},\n\t\t\n\t\t_initBox: function() {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\t$(\"#drag-btn\").on(\"mousedown\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\tself.dragElement = self.selectedEl.css(\"position\",\"\");\n\t\t\t\tself.isDragging = true;\n\t\t\t\t\n\t\t\t\tnode = self.dragElement.get(0);\n\n\t\t\t\tself.dragMoveMutation = {type: 'move', \n\t\t\t\t\t\t\t\t\ttarget: node,\n\t\t\t\t\t\t\t\t\toldParent: node.parentNode,\n\t\t\t\t\t\t\t\t\toldNextSibling: node.nextSibling};\n\t\t\t\t\t\n\t\t\t\t//self.selectNode(false);\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#down-btn\").on(\"click\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\n\t\t\t\tnode = self.selectedEl.get(0);\n\t\t\t\toldParent = node.parentNode;\n\t\t\t\toldNextSibling = node.nextSibling;\n\n\t\t\t\tnext = self.selectedEl.next();\n\t\t\t\t\n\t\t\t\tif (next.length > 0)\n\t\t\t\t{\n\t\t\t\t\tnext.after(self.selectedEl);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tself.selectedEl.parent().after(self.selectedEl);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnewParent = node.parentNode;\n\t\t\t\tnewNextSibling = node.nextSibling;\n\t\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'move', \n\t\t\t\t\t\t\t\t\t\ttarget: node,\n\t\t\t\t\t\t\t\t\t\toldParent: oldParent,\n\t\t\t\t\t\t\t\t\t\tnewParent: newParent,\n\t\t\t\t\t\t\t\t\t\toldNextSibling: oldNextSibling,\n\t\t\t\t\t\t\t\t\t\tnewNextSibling: newNextSibling});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#up-btn\").on(\"click\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\n\t\t\t\tnode = self.selectedEl.get(0);\n\t\t\t\toldParent = node.parentNode;\n\t\t\t\toldNextSibling = node.nextSibling;\n\n\t\t\t\tnext = self.selectedEl.prev();\n\t\t\t\t\n\t\t\t\tif (next.length > 0)\n\t\t\t\t{\n\t\t\t\t\tnext.before(self.selectedEl);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tself.selectedEl.parent().before(self.selectedEl);\n\t\t\t\t}\n\n\t\t\t\tnewParent = node.parentNode;\n\t\t\t\tnewNextSibling = node.nextSibling;\n\t\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'move', \n\t\t\t\t\t\t\t\t\t\ttarget: node,\n\t\t\t\t\t\t\t\t\t\toldParent: oldParent,\n\t\t\t\t\t\t\t\t\t\tnewParent: newParent,\n\t\t\t\t\t\t\t\t\t\toldNextSibling: oldNextSibling,\n\t\t\t\t\t\t\t\t\t\tnewNextSibling: newNextSibling});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#clone-btn\").on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\tclone = self.selectedEl.clone();\n\t\t\t\t\n\t\t\t\tself.selectedEl.after(clone);\n\t\t\t\t\n\t\t\t\tself.selectedEl = clone.click();\n\t\t\t\t\n\t\t\t\tnode = clone.get(0);\n\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\taddedNodes: [node],\n\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#parent-btn\").on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\tnode = self.selectedEl.parent().get(0);\n\t\t\t\t\n\t\t\t\tself.selectNode(node);\n\t\t\t\tself.loadNodeComponent(node);\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t$(\"#delete-btn\").on(\"click\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\t\n\t\t\t\tnode = self.selectedEl.get(0);\n\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\tremovedNodes: [node],\n\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\n\t\t\t\tself.selectedEl.remove();\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tvar addSectionBox = jQuery(\"#add-section-box\");\n\t\t\tvar addSectionElement = {};\n\t\t\t\n\t\t\t$(\"#add-section-btn\").on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\taddSectionElement = self.highlightEl; \n\n\t\t\t\tvar offset = jQuery(addSectionElement).offset();\t\t\t\n\t\t\t\tvar top = (offset.top - self.frameDoc.scrollTop()) + addSectionElement.outerHeight();\n\t\t\t\tvar left = (offset.left - self.frameDoc.scrollLeft()) + (addSectionElement.outerWidth() / 2) - (addSectionBox.outerWidth() / 2);\n\t\t\t\tvar outerHeight = $(window.FrameWindow).height() + self.frameDoc.scrollTop();\n\n\t\t\t\t//check if box is out of viewport and move inside\n\t\t\t\tif (left < 0) left = 0;\n\t\t\t\tif (top < 0) top = 0;\n\t\t\t\tif ((left + addSectionBox.outerWidth()) > self.frameDoc.outerWidth()) left = self.frameDoc.outerWidth() - addSectionBox.outerWidth();\n\t\t\t\tif (((top + addSectionBox.outerHeight()) + self.frameDoc.scrollTop()) > outerHeight) top = top - addSectionBox.outerHeight();\n\t\t\t\t\n\t\t\t\t\n\t\t\t\taddSectionBox.css(\n\t\t\t\t\t{\"top\": top, \n\t\t\t\t\t \"left\": left, \n\t\t\t\t\t \"display\": \"block\",\n\t\t\t\t\t });\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#close-section-btn\").on(\"click\", function(event) {\n\t\t\t\taddSectionBox.hide();\n\t\t\t});\n\t\t\t\n\t\t\tfunction addSectionComponent(html, after = true) \n\t\t\t{\n\t\t\t\tvar node = $(html);\n\t\t\t\t\n\t\t\t\tif (after)\n\t\t\t\t{\n\t\t\t\t\taddSectionElement.after(node);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\taddSectionElement.append(node);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnode = node.get(0);\n\t\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\taddedNodes: [node], \n\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\t\t\t}\n\t\t\t\n\t\t\t$(\".components-list li ol li\", addSectionBox).on(\"click\", function(event) {\n\t\t\t\tvar html = Vvveb.Components.get(this.dataset.type).html;\n\n\t\t\t\taddSectionComponent(html, (jQuery(\"[name='add-section-insert-mode']:checked\").val() == \"after\"));\n\n\t\t\t\taddSectionBox.hide();\n\t\t\t});\n\n\t\t\t$(\".blocks-list li ol li\", addSectionBox).on(\"click\", function(event) {\n\t\t\t\tvar html = Vvveb.Blocks.get(this.dataset.type).html;\n\n\t\t\t\taddSectionComponent(html, (jQuery(\"[name='add-section-insert-mode']:checked\").val() == \"after\"));\n\n\t\t\t\taddSectionBox.hide();\n\t\t\t});\n\t\t\t\n\t\t},\t\n\n\t/* drag and drop */\n\t\t_initDragdrop : function() {\n\n\t\t\tvar self = this;\n\t\t\tself.isDragging = false;\t\n\t\t\t\n\t\t\t$('.drag-elements-sidepane ul > li > ol > li').on(\"mousedown touchstart\", function(event) {\n\t\t\t\t\n\t\t\t\t$this = jQuery(this);\n\t\t\t\t\n\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t\t\n\t\t\t\tif ($this.data(\"drag-type\") == \"component\")\n\t\t\t\t\tself.component = Vvveb.Components.get($this.data(\"type\"));\n\t\t\t\telse\n\t\t\t\t\tself.component = Vvveb.Blocks.get($this.data(\"type\"));\n\t\t\t\t\n\t\t\t\tif (self.component.dragHtml)\n\t\t\t\t{\n\t\t\t\t\thtml = self.component.dragHtml;\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\thtml = self.component.html;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tself.dragElement = $(html);\n\t\t\t\tself.dragElement.css(\"border\", \"1px dashed #4285f4\");\n\t\t\t\t\n\t\t\t\tif (self.component.dragStart) self.dragElement = self.component.dragStart(self.dragElement);\n\n\t\t\t\tself.isDragging = true;\n\t\t\t\tif (Vvveb.dragIcon == 'html')\n\t\t\t\t{\n\t\t\t\t\tself.iconDrag = $(html).attr(\"id\", \"dragElement-clone\").css('position', 'absolute');\n\t\t\t\t}\n\t\t\t\telse if (self.designerMode == false)\n\t\t\t\t{\n\t\t\t\t\tself.iconDrag = $('<img src=\"\"/>').attr({\"id\": \"dragElement-clone\", 'src': $this.css(\"background-image\").replace(/^url\\(['\"](.+)['\"]\\)/, '$1')}).\n\t\t\t\t\tcss({'z-index':100, 'position':'absolute', 'width':'64px', 'height':'64px', 'top': event.originalEvent.y, 'left': event.originalEvent.x});\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t$('body').append(self.iconDrag);\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$('body').on('mouseup touchend', function(event) {\n\t\t\t\tif (self.iconDrag && self.isDragging == true)\n\t\t\t\t{\n\t\t\t\t\tself.isDragging = false;\n\t\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t\t\tself.iconDrag.remove();\n\t\t\t\t\tif(self.dragElement){\n\t\t\t\t\t\tself.dragElement.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t$('body').on('mousemove touchmove', function(event) {\n\t\t\t\tif (self.iconDrag && self.isDragging == true)\n\t\t\t\t{\n\t\t\t\t\tvar x = (event.clientX || event.originalEvent.clientX);\n\t\t\t\t\tvar y = (event.clientY || event.originalEvent.clientY);\n\n\t\t\t\t\tself.iconDrag.css({'left': x - 60, 'top': y - 30});\n\n\t\t\t\t\telementMouseIsOver = document.elementFromPoint(x - 60, y - 40);\n\t\t\t\t\t\n\t\t\t\t\t//if drag elements hovers over iframe switch to iframe mouseover handler\t\n\t\t\t\t\tif (elementMouseIsOver && elementMouseIsOver.tagName == 'IFRAME')\n\t\t\t\t\t{\n\t\t\t\t\t\tself.frameBody.trigger(\"mousemove\", event);\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tself.selectNode(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t$('.drag-elements-sidepane ul > ol > li > li').on(\"mouseup touchend\", function(event) {\n\t\t\t\tself.isDragging = false;\n\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t});\n\t\t\t\t\n\t\t},\n\t\t\n\t\tremoveHelpers: function (html, keepHelperAttributes = false)\n\t\t{\n\t\t\t//tags like stylesheets or scripts \n\t\t\thtml = html.replace(/<.*?data-vvveb-helpers.*?>/gi, \"\");\n\t\t\t//attributes\n\t\t\tif (!keepHelperAttributes)\n\t\t\t{\n\t\t\t\thtml = html.replace(/\\s*data-vvveb-\\w+(=[\"'].*?[\"'])?\\s*/gi, \"\");\n\t\t\t}\n\t\t\t\n\t\t\treturn html;\n\t\t},\n\n\t\tgetHtml: function(keepHelperAttributes = true) \n\t\t{\n\t\t\tvar doc = window.FrameDocument;\n\t\t\tvar hasDoctpe = (doc.doctype !== null);\n\t\t\tvar html = \"\";\n\t\t\t\n\t\t\t$(window).triggerHandler(\"vvveb.getHtml.before\", doc);\n\t\t\t\n\t\t\tif (hasDoctpe) html =\n\t\t\t\"<!DOCTYPE \"\n\t         + doc.doctype.name\n\t         + (doc.doctype.publicId ? ' PUBLIC \"' + doc.doctype.publicId + '\"' : '')\n\t         + (!doc.doctype.publicId && doc.doctype.systemId ? ' SYSTEM' : '') \n\t         + (doc.doctype.systemId ? ' \"' + doc.doctype.systemId + '\"' : '')\n\t         + \">\\n\";\n\t          \n\t         html +=  doc.documentElement.innerHTML + \"\\n</html>\";\n\t         \n\t         html = this.removeHelpers(html, keepHelperAttributes);\n\t         \n\t         var filter = $(window).triggerHandler(\"vvveb.getHtml.after\", html);\n\t         if (filter) return filter;\n\t         \n\t         return html;\n\t\t},\n\t\t\n\t\tsetHtml: function(html) \n\t\t{\n\t\t\t//update only body to avoid breaking iframe css/js relative paths\n\t\t\tstart = html.indexOf(\"<body\");\n\t        end = html.indexOf(\"</body\");\t\t\n\n\t        if (start >= 0 && end >= 0) {\n\t            body = html.slice(html.indexOf(\">\", start) + 1, end);\n\t        } else {\n\t            body = html\n\t        }\n\t        \n\t        if (this.runJsOnSetHtml)\n\t\t\t\tself.frameBody.html(body);\n\t\t\telse\n\t\t\t\twindow.FrameDocument.body.innerHTML = body;\n\t        \n\t\t\t\n\t\t\t//below methods brake document relative css and js paths\n\t\t\t//return self.iframe.outerHTML = html;\n\t\t\t//return self.documentFrame.html(html);\n\t\t\t//return self.documentFrame.attr(\"srcdoc\", html);\n\t\t},\n\t\t\n\t\tsaveAjax: function(fileName, startTemplateUrl, callback)\n\t\t{\n\t\t\tvar data = {};\n\t\t\tdata[\"fileName\"] = (fileName && fileName != \"\") ? fileName : Vvveb.FileManager.getCurrentUrl();\n\t\t\tdata[\"startTemplateUrl\"] = startTemplateUrl;\n\t\t\tif (!startTemplateUrl || startTemplateUrl == null)\n\t\t\t{\n\t\t\t\tdata[\"html\"] = this.getHtml();\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\ttype: \"POST\",\n\t\t\t\turl: 'save.php',//set your server side save script url\n\t\t\t\tdata: data,\n\t\t\t\tcache: false,\n\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\n\t\t\t\t\tif (callback) callback(data);\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\terror: function (data) {\n\t\t\t\t\talert(data.responseText);\n\t\t\t\t}\n\t\t\t});\t\t\t\t\t\n\t\t},\n\t\t\n\t\tsetDesignerMode: function(designerMode = false)\n\t\t{\n\t\t\tthis.designerMode = designerMode;\n\t\t}\n\n\t};\n\n});\n\n\n"]}