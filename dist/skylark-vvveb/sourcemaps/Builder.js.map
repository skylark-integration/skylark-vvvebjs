{"version":3,"sources":["Builder.js"],"names":["define","$","Vvveb","Builder","component","dragMoveMutation","isPreview","runJsOnSetHtml","designerMode","init","url","callback","this","loadControlGroups","loadBlockGroups","selectedEl","highlightEl","initCallback","documentFrame","canvas","_loadIframe","_initDragdrop","_initBox","dragElement","componentsList","empty","item","each","list","type","dataset","group","ComponentsGroup","append","componentsSubList","find","i","components","componentType","Components","get","name","toLowerCase","image","css","backgroundImage","backgroundRepeat","blocksList","BlocksGroup","blocksSubList","blocks","blockType","block","Blocks","indexOf","loadUrl","jQuery","hide","self","iframe","src","on","window","FrameWindow","contentWindow","FrameDocument","document","event","Undo","undoIndex","returnValue","offset","top","frameDoc","scrollTop","left","scrollLeft","width","outerWidth","height","outerHeight","WysiwygEditor","_frameLoaded","frameHtml","frameBody","frameHead","baseUrl","_initHighlight","_getElementType","el","componentName","attributes","j","length","nodeName","replace","tagName","loadNodeComponent","node","data","matchNode","defaultComponent","render","selectNode","texteditEl","destroy","removeClass","show","target","display","err","console","log","html","isElement","originalEvent","halfHeight","Math","max","halfWidth","x","clientX","y","clientY","isDragging","parent","isIE11","appendTo","prepend","prependTo","parentOffset","offsetParent","position","iconDrag","hasAttribute","border","remove","dragHtml","newElement","replaceWith","afterDrop","addMutation","parentNode","addedNodes","nextSibling","newParent","newNextSibling","edit","attr","contenteditable","spellcheckker","addClass","is","tab","preventDefault","oldParent","oldNextSibling","next","after","prev","before","clone","click","removedNodes","addSectionBox","addSectionElement","addSectionComponent","val","$this","dragStart","dragIcon","id","z-index","elementMouseIsOver","elementFromPoint","trigger","stopPropagation","removeHelpers","keepHelperAttributes","getHtml","doc","doctype","publicId","systemId","documentElement","innerHTML","setHtml","start","end","body","slice","saveAjax","fileName","startTemplateUrl","FileManager","getCurrentUrl","ajax","cache","success","error","alert","responseText","setDesignerMode"],"mappings":"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","file":"../Builder.js","sourcesContent":["define([\n\t\"skylark-utils-dom/query\",\n\t\"./Vvveb\"\n],function($,Vvveb){\n\treturn Vvveb.Builder = {\n\n\t\tcomponent : {},\n\t\tdragMoveMutation : false,\n\t\tisPreview : false,\n\t\trunJsOnSetHtml : false,\n\t\tdesignerMode : false,\n\t\t\n\t\tinit: function(url, callback) {\n\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tself.loadControlGroups();\n\t\t\tself.loadBlockGroups();\n\t\t\t\n\t\t\tself.selectedEl = null;\n\t\t\tself.highlightEl = null;\n\t\t\tself.initCallback = callback;\n\t\t\t\n\t        self.documentFrame = $(\"#iframe-wrapper > iframe\");\n\t        self.canvas = $(\"#canvas\");\n\n\t\t\tself._loadIframe(url);\n\t\t\t\n\t\t\tself._initDragdrop();\n\t\t\t\n\t\t\tself._initBox();\n\n\t\t\tself.dragElement = null;\n\t\t},\n\t\t\n\t\tloadControlGroups : function() {\t\n\n\t\t\tvar componentsList = $(\".components-list\");\n\t\t\tcomponentsList.empty();\n\t\t\tvar item = {}, component = {};\n\t\t\t\n\t\t\tcomponentsList.each(function ()\n\t\t\t{\n\t\t\t\tvar list = $(this);\n\t\t\t\tvar type = this.dataset.type;\n\t\t\t\t\n\t\t\t\tfor (group in Vvveb.ComponentsGroup)\t\n\t\t\t\t{\n\t\t\t\t\tlist.append('<li class=\"header clearfix\" data-section=\"' + group + '\"  data-search=\"\"><label class=\"header\" for=\"' + type + '_comphead_' + group + '\">' + group + '  <div class=\"header-arrow\"></div>\\\n\t\t\t\t\t\t\t\t\t\t   </label><input class=\"header_check\" type=\"checkbox\" checked=\"true\" id=\"' + type + '_comphead_' + group + '\">  <ol></ol></li>');\n\n\t\t\t\t\tvar componentsSubList = list.find('li[data-section=\"' + group + '\"]  ol');\n\t\t\t\t\t\n\t\t\t\t\tcomponents = Vvveb.ComponentsGroup[ group ];\n\t\t\t\t\t\n\t\t\t\t\tfor (i in components)\n\t\t\t\t\t{\n\t\t\t\t\t\tcomponentType = components[i];\n\t\t\t\t\t\tcomponent = Vvveb.Components.get(componentType);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (component)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem = $('<li data-section=\"' + group + '\" data-drag-type=component data-type=\"' + componentType + '\" data-search=\"' + component.name.toLowerCase() + '\"><a href=\"#\">' + component.name + \"</a></li>\");\n\n\t\t\t\t\t\t\tif (component.image) {\n\n\t\t\t\t\t\t\t\titem.css({\n\t\t\t\t\t\t\t\t\tbackgroundImage: \"url(\" + 'libs/builder/' + component.image + \")\",\n\t\t\t\t\t\t\t\t\tbackgroundRepeat: \"no-repeat\"\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tcomponentsSubList.append(item)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t },\n\t\t \n\t\tloadBlockGroups : function() {\t\n\n\t\t\tvar blocksList = $(\".blocks-list\");\n\t\t\tblocksList.empty();\n\t\t\tvar item = {};\n\n\t\t\tblocksList.each(function ()\n\t\t\t{\n\n\t\t\t\tvar list = $(this);\n\t\t\t\tvar type = this.dataset.type;\n\n\t\t\t\tfor (group in Vvveb.BlocksGroup)\t\n\t\t\t\t{\n\t\t\t\t\tlist.append('<li class=\"header\" data-section=\"' + group + '\"  data-search=\"\"><label class=\"header\" for=\"' + type + '_blockhead_' + group + '\">' + group + '  <div class=\"header-arrow\"></div>\\\n\t\t\t\t\t\t\t\t\t\t   </label><input class=\"header_check\" type=\"checkbox\" checked=\"true\" id=\"' + type + '_blockhead_' + group + '\">  <ol></ol></li>');\n\n\t\t\t\t\tvar blocksSubList = list.find('li[data-section=\"' + group + '\"]  ol');\n\t\t\t\t\tblocks = Vvveb.BlocksGroup[ group ];\n\n\t\t\t\t\tfor (i in blocks)\n\t\t\t\t\t{\n\t\t\t\t\t\tblockType = blocks[i];\n\t\t\t\t\t\tblock = Vvveb.Blocks.get(blockType);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem = $('<li data-section=\"' + group + '\" data-drag-type=block data-type=\"' + blockType + '\" data-search=\"' + block.name.toLowerCase() + '\"><a href=\"#\">' + block.name + \"</a></li>\");\n\n\t\t\t\t\t\t\tif (block.image) {\n\n\t\t\t\t\t\t\t\titem.css({\n\t\t\t\t\t\t\t\t\tbackgroundImage: \"url(\" + ((block.image.indexOf('//') == -1) ? 'libs/builder/':'') + block.image + \")\",\n\t\t\t\t\t\t\t\t\tbackgroundRepeat: \"no-repeat\"\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tblocksSubList.append(item)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t },\n\t\t\n\t\tloadUrl : function(url, callback) {\t\n\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\n\t\t\tself.initCallback = callback;\n\t\t\tif (Vvveb.Builder.iframe.src != url) Vvveb.Builder.iframe.src = url;\n\t\t},\t\t\n\t\t_loadIframe : function(url) {\t// iframe \n\n\t\t\tvar self = this;\n\t\t\tself.iframe = this.documentFrame.get(0);\n\t\t\tself.iframe.src = url;\n\n\t\t    return this.documentFrame.on(\"load\", function() \n\t        {\n\t\t\t\t\twindow.FrameWindow = self.iframe.contentWindow;\n\t\t\t\t\twindow.FrameDocument = self.iframe.contentWindow.document;\n\n\t\t\t\t\t$(window.FrameWindow).on( \"beforeunload\", function(event) {\n\t\t\t\t\t\tif (Vvveb.Undo.undoIndex <= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar dialogText = \"You have unsaved changes\";\n\t\t\t\t\t\t\tevent.returnValue = dialogText;\n\t\t\t\t\t\t\treturn dialogText;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tjQuery(window.FrameWindow).on(\"scroll resize\", function(event) {\n\t\t\t\t\t\n\t\t\t\t\t\t\tif (self.selectedEl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar offset = self.selectedEl.offset();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tjQuery(\"#select-box\").css(\n\t\t\t\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t\t\t\t \"width\" : self.selectedEl.outerWidth(), \n\t\t\t\t\t\t\t\t\t \"height\": self.selectedEl.outerHeight(),\n\t\t\t\t\t\t\t\t\t //\"display\": \"block\"\n\t\t\t\t\t\t\t\t\t });\t\t\t\n\t\t\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (self.highlightEl)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar offset = self.highlightEl.offset();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tjQuery(\"#highlight-box\").css(\n\t\t\t\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t\t\t\t \"width\" : self.highlightEl.outerWidth(), \n\t\t\t\t\t\t\t\t\t \"height\": self.highlightEl.outerHeight(),\n\t\t\t\t\t\t\t\t\t //\"display\": \"block\"\n\t\t\t\t\t\t\t\t\t });\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\tVvveb.WysiwygEditor.init(window.FrameDocument);\n\t\t\t\t\tif (self.initCallback) self.initCallback();\n\n\t                return self._frameLoaded();\n\t        });\t\t\n\t        \n\t\t},\t\n\t    \n\t    _frameLoaded : function() {\n\t\t\t\n\t\t\tvar self = Vvveb.Builder;\n\t\t\t\n\t\t\tself.frameDoc = $(window.FrameDocument);\n\t\t\tself.frameHtml = $(window.FrameDocument).find(\"html\");\n\t\t\tself.frameBody = $(window.FrameDocument).find(\"body\");\n\t\t\tself.frameHead = $(window.FrameDocument).find(\"head\");\n\t\t\t\n\t\t\t//insert editor helpers like non editable areas\n\t\t\tself.frameHead.append('<link data-vvveb-helpers href=\"' + Vvveb.baseUrl + '../../css/vvvebjs-editor-helpers.css\" rel=\"stylesheet\">');\n\n\t\t\tself._initHighlight();\n\t    },\t\n\t    \n\t    _getElementType: function(el) {\n\t\t\t\n\t\t\t//search for component attribute\n\t\t\tcomponentName = '';  \n\t\t\t   \n\t\t\tif (el.attributes)\n\t\t\tfor (var j = 0; j < el.attributes.length; j++){\n\t\t\t\t\n\t\t\t  if (el.attributes[j].nodeName.indexOf('data-component') > -1)\t\n\t\t\t  {\n\t\t\t\tcomponentName = el.attributes[j].nodeName.replace('data-component-', '');\t\n\t\t\t  }\n\t\t\t}\n\t\t\t\n\t\t\tif (componentName != '') return componentName;\n\n\t\t\treturn el.tagName;\n\t\t},\n\t\t\n\t\tloadNodeComponent:  function(node) {\n\t\t\tdata = Vvveb.Components.matchNode(node);\n\t\t\tvar component;\n\t\t\t\n\t\t\tif (data) \n\t\t\t\tcomponent = data.type;\n\t\t\telse \n\t\t\t\tcomponent = Vvveb.defaultComponent;\n\t\t\t\t\n\t\t\tVvveb.Components.render(component);\n\n\t\t},\n\t\t\n\t\tselectNode:  function(node) {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (self.texteditEl && self.selectedEl.get(0) != node) \n\t\t\t{\n\t\t\t\tVvveb.WysiwygEditor.destroy(self.texteditEl);\n\t\t\t\tjQuery(\"#select-box\").removeClass(\"text-edit\").find(\"#select-actions\").show();\n\t\t\t\tself.texteditEl = null;\n\t\t\t}\n\n\t\t\tvar target = jQuery(node);\n\t\t\t\n\t\t\tif (target)\n\t\t\t{\n\t\t\t\tself.selectedEl = target;\n\n\t\t\t\ttry {\n\t\t\t\t\tvar offset = target.offset();\n\t\t\t\t\t\t\n\t\t\t\t\tjQuery(\"#select-box\").css(\n\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t \"width\" : target.outerWidth(), \n\t\t\t\t\t\t \"height\": target.outerHeight(),\n\t\t\t\t\t\t \"display\": \"block\",\n\t\t\t\t\t\t });\n\t\t\t\t} catch(err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t \n\t\t\tjQuery(\"#highlight-name\").html(this._getElementType(node));\n\t\t\t\n\t\t},\n\n\t \n\t    _initHighlight: function() { // iframe highlight\n\t\t\t\n\t\t\tvar self = Vvveb.Builder;\n\t\t\t\n\t\t\tself.frameHtml.on(\"mousemove touchmove\", function(event) {\n\t\t\t\t\n\t\t\t\tif (event.target && isElement(event.target) && event.originalEvent)\n\t\t\t\t{\n\t\t\t\t\tself.highlightEl = target = jQuery(event.target);\n\t\t\t\t\tvar offset = target.offset();\n\t\t\t\t\tvar height = target.outerHeight();\n\t\t\t\t\tvar halfHeight = Math.max(height / 2, 50);\n\t\t\t\t\tvar width = target.outerWidth();\n\t\t\t\t\tvar halfWidth = Math.max(width / 2, 50);\n\t\t\t\t\t\n\t\t\t\t\tvar x = (event.clientX || event.originalEvent.clientX);\n\t\t\t\t\tvar y = (event.clientY || event.originalEvent.clientY);\n\t\t\t\t\t\n\t\t\t\t\tif (self.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parent = self.highlightEl;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (event.originalEvent)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ((offset.top  < (y - halfHeight)) || (offset.left  < (x - halfWidth)))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t if (isIE11) \n\t\t\t\t\t\t\t\t\t\tself.highlightEl.append(self.dragElement); \n\t\t\t\t\t\t\t\t\t else \n\t\t\t\t\t\t\t\t\t\tself.dragElement.appendTo(parent);\n\t\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (isIE11) \n\t\t\t\t\t\t\t\t\t self.highlightEl.prepend(self.dragElement); \n\t\t\t\t\t\t\t\t\telse \n\t\t\t\t\t\t\t\t\t\tself.dragElement.prependTo(parent);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (self.designerMode)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar parentOffset = self.dragElement.offsetParent().offset();\n\n\t\t\t\t\t\t\t\t\tself.dragElement.css({\n\t\t\t\t\t\t\t\t\t\t\"position\": \"absolute\",\n\t\t\t\t\t\t\t\t\t\t'left': x - (parentOffset.left - self.frameDoc.scrollLeft()), \n\t\t\t\t\t\t\t\t\t\t'top': y - (parentOffset.top - self.frameDoc.scrollTop()),\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!self.designerMode && self.iconDrag) self.iconDrag.css({'left': x + 275/*left panel width*/, 'top':y - 30 });\t\t\t\t\t\n\t\t\t\t\t}// else //uncomment else to disable parent highlighting when dragging\n\t\t\t\t\t{\n\t\t\t\t\t\t\n\t\t\t\t\t\tjQuery(\"#highlight-box\").css(\n\t\t\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() , \n\t\t\t\t\t\t\t \"left\": offset.left - self.frameDoc.scrollLeft() , \n\t\t\t\t\t\t\t \"width\" : width, \n\t\t\t\t\t\t\t \"height\": height,\n\t\t\t\t\t\t\t  \"display\" : event.target.hasAttribute('contenteditable')?\"none\":\"block\",\n\t\t\t\t\t\t\t  \"border\":self.isDragging?\"1px dashed aqua\":\"\",//when dragging highlight parent with green\n\t\t\t\t\t\t\t });\n\t\t\t\t\t\t\t \n\t\t\t\t\t\tjQuery(\"#highlight-name\").html(self._getElementType(event.target));\n\t\t\t\t\t\tif (self.isDragging) jQuery(\"#highlight-name\").hide(); else jQuery(\"#highlight-name\").show();//hide tag name when dragging\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\tself.frameHtml.on(\"mouseup touchend\", function(event) {\n\t\t\t\tif (self.isDragging)\n\t\t\t\t{\n\t\t\t\t\tself.isDragging = false;\n\t\t\t\t\tif (self.iconDrag) self.iconDrag.remove();\n\t\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t\t\t\n\t\t\t\t\tif (self.component.dragHtml) //if dragHtml is set for dragging then set real component html\n\t\t\t\t\t{\n\t\t\t\t\t\tnewElement = $(self.component.html);\n\t\t\t\t\t\tself.dragElement.replaceWith(newElement);\n\t\t\t\t\t\tself.dragElement = newElement;\n\t\t\t\t\t}\n\t\t\t\t\tif (self.component.afterDrop) self.dragElement = self.component.afterDrop(self.dragElement);\n\t\t\t\t\t\n\t\t\t\t\tself.dragElement.css(\"border\", \"\");\n\t\t\t\t\t\n\t\t\t\t\tnode = self.dragElement.get(0);\n\t\t\t\t\tself.selectNode(node);\n\t\t\t\t\tself.loadNodeComponent(node);\n\n\t\t\t\t\tif (self.dragMoveMutation === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\t\t\taddedNodes: [node], \n\t\t\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tself.dragMoveMutation.newParent = node.parentNode;\n\t\t\t\t\t\tself.dragMoveMutation.newNextSibling = node.nextSibling;\n\t\t\t\t\t\t\n\t\t\t\t\t\tVvveb.Undo.addMutation(self.dragMoveMutation);\n\t\t\t\t\t\tself.dragMoveMutation = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.frameHtml.on(\"dblclick\", function(event) {\n\t\t\t\t\n\t\t\t\tif (Vvveb.Builder.isPreview == false)\n\t\t\t\t{\n\t\t\t\t\tself.texteditEl = target = jQuery(event.target);\n\n\t\t\t\t\tVvveb.WysiwygEditor.edit(self.texteditEl);\n\t\t\t\t\t\n\t\t\t\t\tself.texteditEl.attr({'contenteditable':true, 'spellcheckker':false});\n\t\t\t\t\t\n\t\t\t\t\tself.texteditEl.on(\"blur keyup paste input\", function(event) {\n\n\t\t\t\t\t\tjQuery(\"#select-box\").css({\n\t\t\t\t\t\t\t\t\"width\" : self.texteditEl.outerWidth(), \n\t\t\t\t\t\t\t\t\"height\": self.texteditEl.outerHeight()\n\t\t\t\t\t\t\t });\n\t\t\t\t\t});\t\t\n\t\t\t\t\t\n\t\t\t\t\tjQuery(\"#select-box\").addClass(\"text-edit\").find(\"#select-actions\").hide();\n\t\t\t\t\tjQuery(\"#highlight-box\").hide();\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t\tself.frameHtml.on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\tif (Vvveb.Builder.isPreview == false)\n\t\t\t\t{\n\t\t\t\t\tif (event.target)\n\t\t\t\t\t{\n\t\t\t\t\t\t//if component properties is loaded in left panel tab instead of right panel show tab\n\t\t\t\t\t\tif ($(\".component-properties-tab\").is(\":visible\"))//if properites tab is enabled/visible \n\t\t\t\t\t\t\t$('.component-properties-tab a').show().tab('show'); \n\t\t\t\t\t\t\n\t\t\t\t\t\tself.selectNode(event.target);\n\t\t\t\t\t\tself.loadNodeComponent(event.target);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\t\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t},\n\t\t\n\t\t_initBox: function() {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\t$(\"#drag-btn\").on(\"mousedown\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\tself.dragElement = self.selectedEl.css(\"position\",\"\");\n\t\t\t\tself.isDragging = true;\n\t\t\t\t\n\t\t\t\tnode = self.dragElement.get(0);\n\n\t\t\t\tself.dragMoveMutation = {type: 'move', \n\t\t\t\t\t\t\t\t\ttarget: node,\n\t\t\t\t\t\t\t\t\toldParent: node.parentNode,\n\t\t\t\t\t\t\t\t\toldNextSibling: node.nextSibling};\n\t\t\t\t\t\n\t\t\t\t//self.selectNode(false);\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#down-btn\").on(\"click\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\n\t\t\t\tnode = self.selectedEl.get(0);\n\t\t\t\toldParent = node.parentNode;\n\t\t\t\toldNextSibling = node.nextSibling;\n\n\t\t\t\tnext = self.selectedEl.next();\n\t\t\t\t\n\t\t\t\tif (next.length > 0)\n\t\t\t\t{\n\t\t\t\t\tnext.after(self.selectedEl);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tself.selectedEl.parent().after(self.selectedEl);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnewParent = node.parentNode;\n\t\t\t\tnewNextSibling = node.nextSibling;\n\t\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'move', \n\t\t\t\t\t\t\t\t\t\ttarget: node,\n\t\t\t\t\t\t\t\t\t\toldParent: oldParent,\n\t\t\t\t\t\t\t\t\t\tnewParent: newParent,\n\t\t\t\t\t\t\t\t\t\toldNextSibling: oldNextSibling,\n\t\t\t\t\t\t\t\t\t\tnewNextSibling: newNextSibling});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#up-btn\").on(\"click\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\n\t\t\t\tnode = self.selectedEl.get(0);\n\t\t\t\toldParent = node.parentNode;\n\t\t\t\toldNextSibling = node.nextSibling;\n\n\t\t\t\tnext = self.selectedEl.prev();\n\t\t\t\t\n\t\t\t\tif (next.length > 0)\n\t\t\t\t{\n\t\t\t\t\tnext.before(self.selectedEl);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\tself.selectedEl.parent().before(self.selectedEl);\n\t\t\t\t}\n\n\t\t\t\tnewParent = node.parentNode;\n\t\t\t\tnewNextSibling = node.nextSibling;\n\t\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'move', \n\t\t\t\t\t\t\t\t\t\ttarget: node,\n\t\t\t\t\t\t\t\t\t\toldParent: oldParent,\n\t\t\t\t\t\t\t\t\t\tnewParent: newParent,\n\t\t\t\t\t\t\t\t\t\toldNextSibling: oldNextSibling,\n\t\t\t\t\t\t\t\t\t\tnewNextSibling: newNextSibling});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#clone-btn\").on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\tclone = self.selectedEl.clone();\n\t\t\t\t\n\t\t\t\tself.selectedEl.after(clone);\n\t\t\t\t\n\t\t\t\tself.selectedEl = clone.click();\n\t\t\t\t\n\t\t\t\tnode = clone.get(0);\n\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\taddedNodes: [node],\n\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#parent-btn\").on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\tnode = self.selectedEl.parent().get(0);\n\t\t\t\t\n\t\t\t\tself.selectNode(node);\n\t\t\t\tself.loadNodeComponent(node);\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t$(\"#delete-btn\").on(\"click\", function(event) {\n\t\t\t\tjQuery(\"#select-box\").hide();\n\t\t\t\t\n\t\t\t\tnode = self.selectedEl.get(0);\n\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\tremovedNodes: [node],\n\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\n\t\t\t\tself.selectedEl.remove();\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tvar addSectionBox = jQuery(\"#add-section-box\");\n\t\t\tvar addSectionElement = {};\n\t\t\t\n\t\t\t$(\"#add-section-btn\").on(\"click\", function(event) {\n\t\t\t\t\n\t\t\t\taddSectionElement = self.highlightEl; \n\n\t\t\t\tvar offset = jQuery(this).offset();\t\t\t\n\t\t\t\t\n\t\t\t\taddSectionBox.css(\n\t\t\t\t\t{\"top\": offset.top - self.frameDoc.scrollTop() - $(this).outerHeight(), \n\t\t\t\t\t \"left\": offset.left - (addSectionBox.outerWidth() / 2) - (275) - self.frameDoc.scrollLeft(), \n\t\t\t\t\t \"display\": \"block\",\n\t\t\t\t\t });\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#close-section-btn\").on(\"click\", function(event) {\n\t\t\t\taddSectionBox.hide();\n\t\t\t});\n\t\t\t\n\t\t\tfunction addSectionComponent(html, after = true) \n\t\t\t{\n\t\t\t\tvar node = $(html);\n\t\t\t\t\n\t\t\t\tif (after)\n\t\t\t\t{\n\t\t\t\t\taddSectionElement.after(node);\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\taddSectionElement.append(node);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnode = node.get(0);\n\t\t\t\t\n\t\t\t\tVvveb.Undo.addMutation({type: 'childList', \n\t\t\t\t\t\t\t\t\t\ttarget: node.parentNode, \n\t\t\t\t\t\t\t\t\t\taddedNodes: [node], \n\t\t\t\t\t\t\t\t\t\tnextSibling: node.nextSibling});\n\t\t\t}\n\t\t\t\n\t\t\t$(\".components-list li ol li\", addSectionBox).on(\"click\", function(event) {\n\t\t\t\tvar html = Vvveb.Components.get(this.dataset.type).html;\n\n\t\t\t\taddSectionComponent(html, (jQuery(\"[name='add-section-insert-mode']:checked\").val() == \"after\"));\n\n\t\t\t\taddSectionBox.hide();\n\t\t\t});\n\n\t\t\t$(\".blocks-list li ol li\", addSectionBox).on(\"click\", function(event) {\n\t\t\t\tvar html = Vvveb.Blocks.get(this.dataset.type).html;\n\n\t\t\t\taddSectionComponent(html, (jQuery(\"[name='add-section-insert-mode']:checked\").val() == \"after\"));\n\n\t\t\t\taddSectionBox.hide();\n\t\t\t});\n\t\t\t\n\t\t},\t\n\n\t\n\t\t_initDragdrop : function() {//drag and drop\n\n\t\t\tvar self = this;\n\t\t\tself.isDragging = false;\t\n\t\t\t\n\t\t\t$('.drag-elements-sidepane ul > li > ol > li').on(\"mousedown touchstart\", function(event) {\n\t\t\t\t\n\t\t\t\t$this = jQuery(this);\n\t\t\t\t\n\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t\t\n\t\t\t\tif ($this.data(\"drag-type\") == \"component\")\n\t\t\t\t\tself.component = Vvveb.Components.get($this.data(\"type\"));\n\t\t\t\telse\n\t\t\t\t\tself.component = Vvveb.Blocks.get($this.data(\"type\"));\n\t\t\t\t\n\t\t\t\tif (self.component.dragHtml)\n\t\t\t\t{\n\t\t\t\t\thtml = self.component.dragHtml;\n\t\t\t\t} else\n\t\t\t\t{\n\t\t\t\t\thtml = self.component.html;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tself.dragElement = $(html);\n\t\t\t\tself.dragElement.css(\"border\", \"1px dashed #4285f4\");\n\t\t\t\t\n\t\t\t\tif (self.component.dragStart) self.dragElement = self.component.dragStart(self.dragElement);\n\n\t\t\t\tself.isDragging = true;\n\t\t\t\tif (Vvveb.dragIcon == 'html')\n\t\t\t\t{\n\t\t\t\t\tself.iconDrag = $(html).attr(\"id\", \"dragElement-clone\").css('position', 'absolute');\n\t\t\t\t}\n\t\t\t\telse if (self.designerMode == false)\n\t\t\t\t{\n\t\t\t\t\tself.iconDrag = $('<img src=\"\"/>').attr({\"id\": \"dragElement-clone\", 'src': $this.css(\"background-image\").replace(/^url\\(['\"](.+)['\"]\\)/, '$1')}).\n\t\t\t\t\tcss({'z-index':100, 'position':'absolute', 'width':'64px', 'height':'64px', 'top': event.originalEvent.y, 'left': event.originalEvent.x});\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t$('body').append(self.iconDrag);\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\t$('body').on('mouseup touchend', function(event) {\n\t\t\t\tif (self.iconDrag && self.isDragging == true)\n\t\t\t\t{\n\t\t\t\t\tself.isDragging = false;\n\t\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t\t\tself.iconDrag.remove();\n\t\t\t\t\tif(self.dragElement){\n\t\t\t\t\t\tself.dragElement.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t$('body').on('mousemove touchmove', function(event) {\n\t\t\t\tif (self.iconDrag && self.isDragging == true)\n\t\t\t\t{\n\t\t\t\t\tvar x = (event.clientX || event.originalEvent.clientX);\n\t\t\t\t\tvar y = (event.clientY || event.originalEvent.clientY);\n\n\t\t\t\t\tself.iconDrag.css({'left': x - 60, 'top': y - 30});\n\n\t\t\t\t\telementMouseIsOver = document.elementFromPoint(x - 60, y - 40);\n\t\t\t\t\t\n\t\t\t\t\t//if drag elements hovers over iframe switch to iframe mouseover handler\t\n\t\t\t\t\tif (elementMouseIsOver && elementMouseIsOver.tagName == 'IFRAME')\n\t\t\t\t\t{\n\t\t\t\t\t\tself.frameBody.trigger(\"mousemove\", event);\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tself.selectNode(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t$('.drag-elements-sidepane ul > ol > li > li').on(\"mouseup touchend\", function(event) {\n\t\t\t\tself.isDragging = false;\n\t\t\t\t$(\"#component-clone\").remove();\n\t\t\t});\n\t\t\t\t\n\t\t},\n\t\t\n\t\tremoveHelpers: function (html, keepHelperAttributes = false)\n\t\t{\n\t\t\t//tags like stylesheets or scripts \n\t\t\thtml = html.replace(/<.*?data-vvveb-helpers.*?>/gi, \"\");\n\t\t\t//attributes\n\t\t\tif (!keepHelperAttributes)\n\t\t\t{\n\t\t\t\thtml = html.replace(/\\s*data-vvveb-\\w+(=[\"'].*?[\"'])?\\s*/gi, \"\");\n\t\t\t}\n\t\t\t\n\t\t\treturn html;\n\t\t},\n\n\t\tgetHtml: function(keepHelperAttributes = true) \n\t\t{\n\t\t\tvar doc = window.FrameDocument;\n\t\t\tvar hasDoctpe = (doc.doctype !== null);\n\t\t\tvar html = \"\";\n\t\t\t\n\t\t\tif (hasDoctpe) html =\n\t\t\t\"<!DOCTYPE \"\n\t         + doc.doctype.name\n\t         + (doc.doctype.publicId ? ' PUBLIC \"' + doc.doctype.publicId + '\"' : '')\n\t         + (!doc.doctype.publicId && doc.doctype.systemId ? ' SYSTEM' : '') \n\t         + (doc.doctype.systemId ? ' \"' + doc.doctype.systemId + '\"' : '')\n\t         + \">\\n\";\n\t          \n\t         html +=  doc.documentElement.innerHTML + \"\\n</html>\";\n\t         \n\t         return this.removeHelpers(html, keepHelperAttributes);\n\t\t},\n\t\t\n\t\tsetHtml: function(html) \n\t\t{\n\t\t\t//update only body to avoid breaking iframe css/js relative paths\n\t\t\tstart = html.indexOf(\"<body\");\n\t        end = html.indexOf(\"</body\");\t\t\n\n\t        if (start >= 0 && end >= 0) {\n\t            body = html.slice(html.indexOf(\">\", start) + 1, end);\n\t        } else {\n\t            body = html\n\t        }\n\t        \n\t        if (this.runJsOnSetHtml)\n\t\t\t\tself.frameBody.html(body);\n\t\t\telse\n\t\t\t\twindow.FrameDocument.body.innerHTML = body;\n\t        \n\t\t\t\n\t\t\t//below methods brake document relative css and js paths\n\t\t\t//return self.iframe.outerHTML = html;\n\t\t\t//return self.documentFrame.html(html);\n\t\t\t//return self.documentFrame.attr(\"srcdoc\", html);\n\t\t},\n\t\t\n\t\tsaveAjax: function(fileName, startTemplateUrl, callback)\n\t\t{\n\t\t\tvar data = {};\n\t\t\tdata[\"fileName\"] = (fileName && fileName != \"\") ? fileName : Vvveb.FileManager.getCurrentUrl();\n\t\t\tdata[\"startTemplateUrl\"] = startTemplateUrl;\n\t\t\tif (!startTemplateUrl || startTemplateUrl == null)\n\t\t\t{\n\t\t\t\tdata[\"html\"] = this.getHtml();\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\ttype: \"POST\",\n\t\t\t\turl: 'save.php',//set your server side save script url\n\t\t\t\tdata: data,\n\t\t\t\tcache: false,\n\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\n\t\t\t\t\tif (callback) callback(data);\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\terror: function (data) {\n\t\t\t\t\talert(data.responseText);\n\t\t\t\t}\n\t\t\t});\t\t\t\t\t\n\t\t},\n\t\t\n\t\tsetDesignerMode: function(designerMode = false)\n\t\t{\n\t\t\tthis.designerMode = designerMode;\n\t\t}\n\n\t};\n\n});\n\n\n"]}