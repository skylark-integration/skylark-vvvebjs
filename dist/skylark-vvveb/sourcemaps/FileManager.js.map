{"version":3,"sources":["FileManager.js"],"names":["define","$","Vvveb","tmpl","FileManager","tree","pages","currentPage","init","this","html","on","e","preventDefault","page","parentNode","data","loadPage","node","currentTarget","Builder","frameHtml","animate","scrollTop","offset","top","selectNode","loadNodeComponent","trigger","addPage","name","append","addPages","addComponent","url","title","getComponents","allowedComponents","getNodeTree","parent","hasChildNodes","j","childNodes","length","child","undefined","matchChild","Components","matchNode","Array","isArray","indexOf","type","element","image","children","push","window","FrameDocument","body","loadComponents","drawComponentsTree","i","li","replaceWith","getCurrentUrl","reloadCurrentPage","disableCache","removeClass","addClass","loadUrl","Math","random","scrollBottom","scroll","prop"],"mappings":";;;;;;;AAAAA,QACC,iBACA,UACA,UACC,SAASC,EAAEC,EAAMC,GAClB,OAAOD,EAAME,aACZC,MAAK,EACLC,SACAC,aAAa,EAEbC,KAAM,WACLC,KAAKJ,KAAOJ,EAAE,2BAA2BS,KAAK,IAE9CT,EAAEQ,KAAKJ,MAAMM,GAAG,QAAS,IAAK,SAAUC,GAEvC,OADAA,EAAEC,kBACK,IAGRZ,EAAEQ,KAAKJ,MAAMM,GAAG,QAAS,sBAAuB,SAAUC,GACzD,IAAIE,EAAOb,EAAEQ,KAAKM,YAAYC,KAAK,QAGnC,OADIF,GAAMZ,EAAME,YAAYa,SAASH,IAC9B,IAGRb,EAAEQ,KAAKJ,MAAMM,GAAG,QAAS,4BAA6B,SAAUC,GAC/DM,KAAOjB,EAAEW,EAAEO,cAAcJ,YAAYC,KAAK,QAE1Cd,EAAMkB,QAAQC,UAAUC,SACvBC,UAAWtB,EAAEiB,MAAMM,SAASC,KAC1B,KAEHvB,EAAMkB,QAAQM,WAAWR,MACzBhB,EAAMkB,QAAQO,kBAAkBT,QAI9BP,GAAG,aAAc,2BAA4B,SAAUC,GAEzDM,KAAOjB,EAAEW,EAAEO,eAAeH,KAAK,QAC/Bf,EAAEiB,MAAMU,QAAQ,gBAKlBC,QAAS,SAASC,EAAMd,GAEvBP,KAAKH,MAAMwB,GAAQd,EACnBA,EAAW,KAAIc,EAEfrB,KAAKJ,KAAK0B,OACT5B,EAAK,yBAA0Ba,KAGjCgB,SAAU,SAAS1B,GAClB,IAAKQ,QAAQR,EAEZG,KAAKoB,QAAQvB,EAAMQ,MAAY,KAAGR,EAAMQ,QAI1CmB,aAAc,SAASH,EAAMI,EAAKC,EAAOrB,GACxCb,EAAE,eAAiBa,EAAO,UAAWL,KAAKJ,MAAM0B,OAC/C5B,EAAK,+BAAgC2B,KAAKA,EAAMI,IAAIA,EAAKC,MAAMA,MAGjEC,cAAe,SAASC,MAEtB,IAAIhC,KAmCL,OAlCC,SAASiC,EAAapB,EAAMqB,GAC3B,GAAIrB,EAAKsB,gBACR,IAAK,IAAIC,EAAI,EAAGA,EAAIvB,EAAKwB,WAAWC,OAAQF,IAG3C,GAFAG,MAAQ1B,EAAKwB,WAAWD,GAEpBG,YAAgCC,GAAvBD,MAAkB,aAC7BE,WAAa5C,EAAM6C,WAAWC,UAAUJ,QAC1C,CACC,GAAIK,MAAMC,QAAQb,KACiC,GAA/CA,EAAkBc,QAAQL,WAAWM,MACzC,SAEAC,SACCvB,KAAMgB,WAAWhB,KACjBwB,MAAOR,WAAWQ,MAClBF,KAAMN,WAAWM,KACjBlC,KAAM0B,MACNW,aAEDF,QAAQE,YACRhB,EAAOiB,KAAKH,SACZA,QAAUf,EAAYM,MAAOS,QAAQE,eAGrCF,QAAUf,EAAYM,MAAOL,GAKhC,OAAO,EAGTD,CAAYmB,OAAOC,cAAcC,KAAMtD,GAEhCA,GAGRuD,eAAgB,SAASvB,MAExB,IACI3B,EAGJ,SAASmD,EAAmBxD,GAE3B,IAAIK,EAAOT,EAAE,aACbwC,IACA,IAAKqB,KAAKzD,EACV,CACC,IAAIa,EAAOb,EAAKyD,GAEhB,GAAIzD,EAAKyD,GAAGP,SAASZ,OAAS,EAC9B,CACC,IAAIoB,EAAK9D,EAAE,uBAAyBiB,EAAKY,KAAO,+BAE9BW,EAAI,8CAAgDvB,EAAKoC,MAAQ,YAAcpC,EAAKY,KAAO,2DAE5EW,EAAI,uBAGrCsB,EAAG/C,KAAK,OAAQE,EAAKA,MACrB6C,EAAGhC,OAAO8B,EAAmB3C,EAAKqC,WAClC7C,EAAKqB,OAAOgC,OAGb,CACC,IAAIA,EAAI9D,EAAE,uBAAyBiB,EAAKY,KAAO,gDAE3BW,EAAI,8CAAgDvB,EAAKoC,MAAQ,YAAcpC,EAAKY,KAAO,+DAE5EW,EAAI,WACvCsB,EAAG/C,KAAK,OAAQE,EAAKA,MACrBR,EAAKqB,OAAOgC,IAId,OAAOrD,EApCGmD,CADApD,KAAK2B,cAAcC,IAE1BI,EAAI,EAsCRxC,EAAE,eAAiBQ,KAAKF,YAAc,UAAWE,KAAKJ,MAAM2D,YAAYtD,IAGzEuD,cAAe,WACd,GAAIxD,KAAKF,YACT,OAAOE,KAAKH,MAAMG,KAAKF,aAAkB,KAG1C2D,kBAAmB,WAClB,GAAIzD,KAAKF,YACT,OAAOE,KAAKQ,SAASR,KAAKF,cAG3BU,SAAU,SAASa,EAAMO,GAAoB,EAAO8B,GAAe,GAClElE,EAAE,cAAeQ,KAAKJ,MAAM+D,YAAY,UACxCnE,EAAE,eAAiB6B,EAAO,KAAMrB,KAAKJ,MAAMgE,SAAS,UAEpD5D,KAAKF,YAAcuB,EACnB,IAAII,EAAMzB,KAAKH,MAAMwB,GAAW,IAEhC5B,EAAMkB,QAAQkD,QAAQpC,GAAOiC,GAAgBjC,EAAIiB,QAAQ,MAAQ,EAAE,IAAI,KAAOoB,KAAKC,SAAS,IAC3F,WACCtE,EAAME,YAAYwD,eAAevB,MAIpCoC,aAAc,WACb,IAAIC,EAASjE,KAAKJ,KAAKkC,SACvBmC,EAAOnD,UAAUmD,EAAOC,KAAK","file":"../FileManager.js","sourcesContent":["define([\r\n\t\"skylark-jquery\",\r\n\t\"./Vvveb\",\r\n\t\"./tmpl\"\r\n],function($,Vvveb,tmpl){\r\n\treturn Vvveb.FileManager = {\r\n\t\ttree:false,\r\n\t\tpages:{},\r\n\t\tcurrentPage: false,\r\n\t\t\r\n\t\tinit: function() {\r\n\t\t\tthis.tree = $(\"#filemanager .tree > ol\").html(\"\");\r\n\t\t\t\r\n\t\t\t$(this.tree).on(\"click\", \"a\", function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t$(this.tree).on(\"click\", \"li[data-page] label\", function (e) {\r\n\t\t\t\tvar page = $(this.parentNode).data(\"page\");\r\n\t\t\t\t\r\n\t\t\t\tif (page) Vvveb.FileManager.loadPage(page);\r\n\t\t\t\treturn false;\t\t\t\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t$(this.tree).on(\"click\", \"li[data-component] label \", function (e) {\r\n\t\t\t\tnode = $(e.currentTarget.parentNode).data(\"node\");\r\n\t\t\t\t\r\n\t\t\t\tVvveb.Builder.frameHtml.animate({\r\n\t\t\t\t\tscrollTop: $(node).offset().top\r\n\t\t\t\t}, 1000);\r\n\r\n\t\t\t\tVvveb.Builder.selectNode(node);\r\n\t\t\t\tVvveb.Builder.loadNodeComponent(node);\r\n\t\t\t\t\r\n\t\t\t\t//e.preventDefault();\r\n\t\t\t\t//return false;\r\n\t\t\t}).on(\"mouseenter\", \"li[data-component] label\", function (e) {\r\n\r\n\t\t\t\tnode = $(e.currentTarget).data(\"node\");\r\n\t\t\t\t$(node).trigger(\"mousemove\");\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\taddPage: function(name, data) {\r\n\t\t\t\r\n\t\t\tthis.pages[name] = data;\r\n\t\t\tdata['name'] = name;\r\n\t\t\t\r\n\t\t\tthis.tree.append(\r\n\t\t\t\ttmpl(\"vvveb-filemanager-page\", data));\r\n\t\t},\r\n\t\t\r\n\t\taddPages: function(pages) {\r\n\t\t\tfor (page in pages)\r\n\t\t\t{\r\n\t\t\t\tthis.addPage(pages[page]['name'], pages[page]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\taddComponent: function(name, url, title, page) {\r\n\t\t\t$(\"[data-page='\" + page + \"'] > ol\", this.tree).append(\r\n\t\t\t\ttmpl(\"vvveb-filemanager-component\", {name:name, url:url, title:title}));\r\n\t\t},\r\n\t\t\r\n\t\tgetComponents: function(allowedComponents = {}) {\r\n\r\n\t\t\t\tvar tree = [];\r\n\t\t\t\tfunction getNodeTree (node, parent) {\r\n\t\t\t\t\tif (node.hasChildNodes()) {\r\n\t\t\t\t\t\tfor (var j = 0; j < node.childNodes.length; j++) {\r\n\t\t\t\t\t\t\tchild = node.childNodes[j];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (child && child[\"attributes\"] != undefined && \r\n\t\t\t\t\t\t\t\t(matchChild = Vvveb.Components.matchNode(child))) \r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (Array.isArray(allowedComponents)\r\n\t\t\t\t\t\t\t\t\t&& allowedComponents.indexOf(matchChild.type) == -1)\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\telement = {\r\n\t\t\t\t\t\t\t\t\tname: matchChild.name,\r\n\t\t\t\t\t\t\t\t\timage: matchChild.image,\r\n\t\t\t\t\t\t\t\t\ttype: matchChild.type,\r\n\t\t\t\t\t\t\t\t\tnode: child,\r\n\t\t\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\telement.children = [];\r\n\t\t\t\t\t\t\t\tparent.push(element);\r\n\t\t\t\t\t\t\t\telement = getNodeTree(child, element.children);\r\n\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement = getNodeTree(child, parent);\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\tgetNodeTree(window.FrameDocument.body, tree);\r\n\t\t\t\r\n\t\t\treturn tree;\r\n\t\t},\r\n\t\t\r\n\t\tloadComponents: function(allowedComponents = {}) {\r\n\r\n\t\t\tvar tree = this.getComponents(allowedComponents);\r\n\t\t\tvar html = drawComponentsTree(tree);\r\n\t\t\tvar j = 0;\r\n\r\n\t\t\tfunction drawComponentsTree(tree)\r\n\t\t\t{\r\n\t\t\t\tvar html = $(\"<ol></ol>\");\r\n\t\t\t\tj++;\r\n\t\t\t\tfor (i in tree)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar node = tree[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (tree[i].children.length > 0) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar li = $('<li data-component=\"' + node.name + '\">\\\r\n\t\t\t\t\t\t<label for=\"id' + j + '\" style=\"background-image:url(libs/builder/' + node.image + ')\"><span>' + node.name + '</span></label>\\\r\n\t\t\t\t\t\t<input type=\"checkbox\" id=\"id' + j + '\">\\\r\n\t\t\t\t\t\t</li>');\t\t\r\n\t\t\t\t\t\tli.data(\"node\", node.node);\r\n\t\t\t\t\t\tli.append(drawComponentsTree(node.children));\r\n\t\t\t\t\t\thtml.append(li);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar li =$('<li data-component=\"' + node.name + '\" class=\"file\">\\\r\n\t\t\t\t\t\t\t\t<label for=\"id' + j + '\" style=\"background-image:url(libs/builder/' + node.image + ')\"><span>' + node.name + '</span></label>\\\r\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"id' + j + '\"></li>');\r\n\t\t\t\t\t\tli.data(\"node\", node.node);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\thtml.append(li);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$(\"[data-page='\" + this.currentPage + \"'] > ol\", this.tree).replaceWith(html);\r\n\t\t},\r\n\t\t\r\n\t\tgetCurrentUrl: function() {\r\n\t\t\tif (this.currentPage)\r\n\t\t\treturn this.pages[this.currentPage]['url'];\r\n\t\t},\r\n\t\t\r\n\t\treloadCurrentPage: function() {\r\n\t\t\tif (this.currentPage)\r\n\t\t\treturn this.loadPage(this.currentPage);\r\n\t\t},\r\n\t\t\r\n\t\tloadPage: function(name, allowedComponents = false, disableCache = true) {\r\n\t\t\t$(\"[data-page]\", this.tree).removeClass(\"active\");\r\n\t\t\t$(\"[data-page='\" + name + \"']\", this.tree).addClass(\"active\");\r\n\t\t\t\r\n\t\t\tthis.currentPage = name;\r\n\t\t\tvar url = this.pages[name]['url'];\r\n\t\t\t\r\n\t\t\tVvveb.Builder.loadUrl(url + (disableCache ? (url.indexOf('?') > -1?'&':'?') + Math.random():''), \r\n\t\t\t\tfunction () { \r\n\t\t\t\t\tVvveb.FileManager.loadComponents(allowedComponents); \r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\tscrollBottom: function() {\r\n\t\t\tvar scroll = this.tree.parent();\t\r\n\t\t\tscroll.scrollTop(scroll.prop(\"scrollHeight\"));\t\r\n\t\t},\r\n\t}\r\n});\r\n"]}