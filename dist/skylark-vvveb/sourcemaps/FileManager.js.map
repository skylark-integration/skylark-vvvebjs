{"version":3,"sources":["FileManager.js"],"names":["define","$","Vvveb","tmpl","FileManager","tree","pages","currentPage","init","this","html","on","e","preventDefault","page","parentNode","data","loadPage","node","currentTarget","Builder","frameHtml","animate","scrollTop","offset","top","selectNode","loadNodeComponent","trigger","addPage","name","title","url","append","addPages","addComponent","getComponents","getNodeTree","parent","hasChildNodes","j","childNodes","length","child","undefined","matchChild","Components","matchNode","element","image","type","children","push","window","FrameDocument","body","loadComponents","drawComponentsTree","i","li","replaceWith","getCurrentUrl","reloadCurrentPage","disableCache","removeClass","addClass","loadUrl","indexOf","Math","random","scrollBottom","scroll","prop"],"mappings":";;;;;;;AAAAA,QACC,0BACA,UACA,UACC,SAASC,EAAEC,EAAMC,GAClB,OAAOD,EAAME,aACZC,MAAK,EACLC,SACAC,aAAa,EAEbC,KAAM,WACLC,KAAKJ,KAAOJ,EAAE,2BAA2BS,KAAK,IAE9CT,EAAEQ,KAAKJ,MAAMM,GAAG,QAAS,IAAK,SAAUC,GAEvC,OADAA,EAAEC,kBACK,IAGRZ,EAAEQ,KAAKJ,MAAMM,GAAG,QAAS,sBAAuB,SAAUC,GACzD,IAAIE,EAAOb,EAAEQ,KAAKM,YAAYC,KAAK,QAGnC,OADIF,GAAMZ,EAAME,YAAYa,SAASH,IAC9B,IAGRb,EAAEQ,KAAKJ,MAAMM,GAAG,QAAS,4BAA6B,SAAUC,GAC/DM,KAAOjB,EAAEW,EAAEO,cAAcJ,YAAYC,KAAK,QAE1Cd,EAAMkB,QAAQC,UAAUC,SACvBC,UAAWtB,EAAEiB,MAAMM,SAASC,KAC1B,KAEHvB,EAAMkB,QAAQM,WAAWR,MACzBhB,EAAMkB,QAAQO,kBAAkBT,QAI9BP,GAAG,aAAc,2BAA4B,SAAUC,GAEzDM,KAAOjB,EAAEW,EAAEO,eAAeH,KAAK,QAC/Bf,EAAEiB,MAAMU,QAAQ,gBAKlBC,QAAS,SAASC,EAAMC,EAAOC,GAE9BvB,KAAKH,MAAMwB,IAASC,MAAMA,EAAOC,IAAIA,GAErCvB,KAAKJ,KAAK4B,OACT9B,EAAK,0BAA2B2B,KAAKA,EAAMC,MAAMA,EAAOC,IAAIA,MAG9DE,SAAU,SAAS5B,GAClB,IAAKQ,QAAQR,EAEZG,KAAKoB,QAAQvB,EAAMQ,MAAY,KAAGR,EAAMQ,MAAa,MAAGR,EAAMQ,MAAW,MAI3EqB,aAAc,SAASL,EAAME,EAAKD,EAAOjB,GACxCb,EAAE,eAAiBa,EAAO,UAAWL,KAAKJ,MAAM4B,OAC/C9B,EAAK,+BAAgC2B,KAAKA,EAAME,IAAIA,EAAKD,MAAMA,MAGjEK,cAAe,WAEb,IAAI/B,KA+BL,OA9BC,SAASgC,EAAanB,EAAMoB,GAC3B,GAAIpB,EAAKqB,gBACR,IAAK,IAAIC,EAAI,EAAGA,EAAItB,EAAKuB,WAAWC,OAAQF,IAC3CG,MAAQzB,EAAKuB,WAAWD,GAEpBG,YAAgCC,GAAvBD,MAAkB,aAC7BE,WAAa3C,EAAM4C,WAAWC,UAAUJ,SAEzCK,SACClB,KAAMe,WAAWf,KACjBmB,MAAOJ,WAAWI,MAClBC,KAAML,WAAWK,KACjBhC,KAAMyB,MACNQ,aAEDH,QAAQG,YACRb,EAAOc,KAAKJ,SACZA,QAAUX,EAAYM,MAAOK,QAAQG,WAGrCH,QAAUX,EAAYM,MAAOL,GAKhC,OAAO,EAGTD,CAAYgB,OAAOC,cAAcC,KAAMlD,GAEhCA,GAGRmD,eAAgB,WAEfnD,KAAOI,KAAK2B,gBACZ1B,KAEA,SAAS+C,EAAmBpD,GAE3B,IAAIK,EAAOT,EAAE,aACbuC,IACA,IAAKkB,KAAKrD,EACV,CACC,IAAIa,EAAOb,EAAKqD,GAEhB,GAAIrD,EAAKqD,GAAGP,SAAST,OAAS,EAC9B,CACC,IAAIiB,EAAK1D,EAAE,uBAAyBiB,EAAKY,KAAO,+BAE9BU,EAAI,8CAAgDtB,EAAK+B,MAAQ,YAAc/B,EAAKY,KAAO,2DAE5EU,EAAI,uBAGrCmB,EAAG3C,KAAK,OAAQE,EAAKA,MACrByC,EAAG1B,OAAOwB,EAAmBvC,EAAKiC,WAClCzC,EAAKuB,OAAO0B,OAGb,CACC,IAAIA,EAAI1D,EAAE,uBAAyBiB,EAAKY,KAAO,gDAE3BU,EAAI,8CAAgDtB,EAAK+B,MAAQ,YAAc/B,EAAKY,KAAO,+DAE5EU,EAAI,WACvCmB,EAAG3C,KAAK,OAAQE,EAAKA,MACrBR,EAAKuB,OAAO0B,IAId,OAAOjD,EAnCD+C,CAAmBpD,MAsC1BJ,EAAE,eAAiBQ,KAAKF,YAAc,UAAWE,KAAKJ,MAAMuD,YAAYlD,OAGzEmD,cAAe,WACd,GAAIpD,KAAKF,YACT,OAAOE,KAAKH,MAAMG,KAAKF,aAAkB,KAG1CuD,kBAAmB,WAClB,GAAIrD,KAAKF,YACT,OAAOE,KAAKQ,SAASR,KAAKF,cAG3BU,SAAU,SAASa,EAAMiC,GAAe,GACvC9D,EAAE,cAAeQ,KAAKJ,MAAM2D,YAAY,UACxC/D,EAAE,eAAiB6B,EAAO,KAAMrB,KAAKJ,MAAM4D,SAAS,UAEpDxD,KAAKF,YAAcuB,EACnB,IAAIE,EAAMvB,KAAKH,MAAMwB,GAAW,IAEhC5B,EAAMkB,QAAQ8C,QAAQlC,GAAO+B,GAAgB/B,EAAImC,QAAQ,MAAQ,EAAE,IAAI,KAAOC,KAAKC,SAAS,IAC3F,WACCnE,EAAME,YAAYoD,oBAIrBc,aAAc,WACb,IAAIC,EAAS9D,KAAKJ,KAAKiC,SACvBiC,EAAOhD,UAAUgD,EAAOC,KAAK","file":"../FileManager.js","sourcesContent":["define([\r\n\t\"skylark-utils-dom/query\",\r\n\t\"./Vvveb\",\r\n\t\"./tmpl\"\r\n],function($,Vvveb,tmpl){\r\n\treturn Vvveb.FileManager = {\r\n\t\ttree:false,\r\n\t\tpages:{},\r\n\t\tcurrentPage: false,\r\n\t\t\r\n\t\tinit: function() {\r\n\t\t\tthis.tree = $(\"#filemanager .tree > ol\").html(\"\");\r\n\t\t\t\r\n\t\t\t$(this.tree).on(\"click\", \"a\", function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t$(this.tree).on(\"click\", \"li[data-page] label\", function (e) {\r\n\t\t\t\tvar page = $(this.parentNode).data(\"page\");\r\n\t\t\t\t\r\n\t\t\t\tif (page) Vvveb.FileManager.loadPage(page);\r\n\t\t\t\treturn false;\t\t\t\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t$(this.tree).on(\"click\", \"li[data-component] label \", function (e) {\r\n\t\t\t\tnode = $(e.currentTarget.parentNode).data(\"node\");\r\n\t\t\t\t\r\n\t\t\t\tVvveb.Builder.frameHtml.animate({\r\n\t\t\t\t\tscrollTop: $(node).offset().top\r\n\t\t\t\t}, 1000);\r\n\r\n\t\t\t\tVvveb.Builder.selectNode(node);\r\n\t\t\t\tVvveb.Builder.loadNodeComponent(node);\r\n\t\t\t\t\r\n\t\t\t\t//e.preventDefault();\r\n\t\t\t\t//return false;\r\n\t\t\t}).on(\"mouseenter\", \"li[data-component] label\", function (e) {\r\n\r\n\t\t\t\tnode = $(e.currentTarget).data(\"node\");\r\n\t\t\t\t$(node).trigger(\"mousemove\");\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\taddPage: function(name, title, url) {\r\n\t\t\t\r\n\t\t\tthis.pages[name] = {title:title, url:url};\r\n\t\t\t\r\n\t\t\tthis.tree.append(\r\n\t\t\t\ttmpl(\"vvveb-filemanager-page\", {name:name, title:title, url:url}));\r\n\t\t},\r\n\t\t\r\n\t\taddPages: function(pages) {\r\n\t\t\tfor (page in pages)\r\n\t\t\t{\r\n\t\t\t\tthis.addPage(pages[page]['name'], pages[page]['title'], pages[page]['url']);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\taddComponent: function(name, url, title, page) {\r\n\t\t\t$(\"[data-page='\" + page + \"'] > ol\", this.tree).append(\r\n\t\t\t\ttmpl(\"vvveb-filemanager-component\", {name:name, url:url, title:title}));\r\n\t\t},\r\n\t\t\r\n\t\tgetComponents: function() {\r\n\r\n\t\t\t\tvar tree = [];\r\n\t\t\t\tfunction getNodeTree (node, parent) {\r\n\t\t\t\t\tif (node.hasChildNodes()) {\r\n\t\t\t\t\t\tfor (var j = 0; j < node.childNodes.length; j++) {\r\n\t\t\t\t\t\t\tchild = node.childNodes[j];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (child && child[\"attributes\"] != undefined && \r\n\t\t\t\t\t\t\t\t(matchChild = Vvveb.Components.matchNode(child))) \r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement = {\r\n\t\t\t\t\t\t\t\t\tname: matchChild.name,\r\n\t\t\t\t\t\t\t\t\timage: matchChild.image,\r\n\t\t\t\t\t\t\t\t\ttype: matchChild.type,\r\n\t\t\t\t\t\t\t\t\tnode: child,\r\n\t\t\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\telement.children = [];\r\n\t\t\t\t\t\t\t\tparent.push(element);\r\n\t\t\t\t\t\t\t\telement = getNodeTree(child, element.children);\r\n\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\telement = getNodeTree(child, parent);\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\tgetNodeTree(window.FrameDocument.body, tree);\r\n\t\t\t\r\n\t\t\treturn tree;\r\n\t\t},\r\n\t\t\r\n\t\tloadComponents: function() {\r\n\r\n\t\t\ttree = this.getComponents();\r\n\t\t\thtml = drawComponentsTree(tree);\r\n\r\n\t\t\tfunction drawComponentsTree(tree)\r\n\t\t\t{\r\n\t\t\t\tvar html = $(\"<ol></ol>\");\r\n\t\t\t\tj++;\r\n\t\t\t\tfor (i in tree)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar node = tree[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (tree[i].children.length > 0) \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar li = $('<li data-component=\"' + node.name + '\">\\\r\n\t\t\t\t\t\t<label for=\"id' + j + '\" style=\"background-image:url(libs/builder/' + node.image + ')\"><span>' + node.name + '</span></label>\\\r\n\t\t\t\t\t\t<input type=\"checkbox\" id=\"id' + j + '\">\\\r\n\t\t\t\t\t\t</li>');\t\t\r\n\t\t\t\t\t\tli.data(\"node\", node.node);\r\n\t\t\t\t\t\tli.append(drawComponentsTree(node.children));\r\n\t\t\t\t\t\thtml.append(li);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar li =$('<li data-component=\"' + node.name + '\" class=\"file\">\\\r\n\t\t\t\t\t\t\t\t<label for=\"id' + j + '\" style=\"background-image:url(libs/builder/' + node.image + ')\"><span>' + node.name + '</span></label>\\\r\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" id=\"id' + j + '\"></li>');\r\n\t\t\t\t\t\tli.data(\"node\", node.node);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\thtml.append(li);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$(\"[data-page='\" + this.currentPage + \"'] > ol\", this.tree).replaceWith(html);\r\n\t\t},\r\n\t\t\r\n\t\tgetCurrentUrl: function() {\r\n\t\t\tif (this.currentPage)\r\n\t\t\treturn this.pages[this.currentPage]['url'];\r\n\t\t},\r\n\t\t\r\n\t\treloadCurrentPage: function() {\r\n\t\t\tif (this.currentPage)\r\n\t\t\treturn this.loadPage(this.currentPage);\r\n\t\t},\r\n\t\t\r\n\t\tloadPage: function(name, disableCache = true) {\r\n\t\t\t$(\"[data-page]\", this.tree).removeClass(\"active\");\r\n\t\t\t$(\"[data-page='\" + name + \"']\", this.tree).addClass(\"active\");\r\n\t\t\t\r\n\t\t\tthis.currentPage = name;\r\n\t\t\tvar url = this.pages[name]['url'];\r\n\t\t\t\r\n\t\t\tVvveb.Builder.loadUrl(url + (disableCache ? (url.indexOf('?') > -1?'&':'?') + Math.random():''), \r\n\t\t\t\tfunction () { \r\n\t\t\t\t\tVvveb.FileManager.loadComponents(); \r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\tscrollBottom: function() {\r\n\t\t\tvar scroll = this.tree.parent();\t\r\n\t\t\tscroll.scrollTop(scroll.prop(\"scrollHeight\"));\t\r\n\t\t},\r\n\t}\r\n});\r\n"]}