{"version":3,"sources":["Undo.js"],"names":["define","Vvveb","Undo","undos","mutations","undoIndex","enabled","addMutation","mutation","Builder","frameBody","trigger","this","splice","restore","undo","type","addedNodes","removedNodes","i","node","nextSibling","parentNode","insertBefore","target","append","removeChild","parent","oldParent","sibling","oldNextSibling","newParent","newNextSibling","innerHTML","oldValue","newValue","value","setAttribute","attributeName","removeAttribute","redo","length","hasChanges"],"mappings":";;;;;;;AAAAA,QACC,WACC,SAASC,GAEV,OAAOA,EAAMC,MAEZC,SACAC,aACAC,WAAY,EACZC,SAAQ,EAKRC,YAAc,SAASC,GAKtBP,EAAMQ,QAAQC,UAAUC,QAAQ,kBAChCC,KAAKR,UAAUS,SAASD,KAAKP,UAAW,EAAGG,IAG5CM,QAAU,SAASN,EAAUO,GAE5B,OAAQP,EAASQ,MAChB,IAAK,YAYJ,GAVY,GAARD,GAEHE,WAAaT,EAASU,aACtBA,aAAeV,EAASS,aAGxBA,WAAaT,EAASS,WACtBC,aAAeV,EAASU,cAGrBD,WAAY,IAAIE,KAAKF,WAExBG,KAAOH,WAAWE,GACdX,EAASa,YAEZb,EAASa,YAAYC,WAAWC,aAAaH,KAAMZ,EAASa,aAG5Db,EAASgB,OAAOC,OAAOL,MAIzB,GAAIF,aAAc,IAAIC,KAAKD,aAE1BE,KAAOF,aAAaC,GACpBC,KAAKE,WAAWI,YAAYN,MAE9B,MACA,IAAK,OACQ,GAARL,GAEHY,OAASnB,EAASoB,UAClBC,QAAUrB,EAASsB,iBAGnBH,OAASnB,EAASuB,UAClBF,QAAUrB,EAASwB,gBAGhBH,QAEHA,QAAQP,WAAWC,aAAaf,EAASgB,OAAQK,SAGjDF,OAAOF,OAAOL,MAEhB,MACA,IAAK,gBACHZ,EAASgB,OAAOS,UAAYlB,EAAOP,EAAS0B,SAAW1B,EAAS2B,SAChE,MACF,IAAK,aACHC,MAAQrB,EAAOP,EAAS0B,SAAW1B,EAAS2B,SAExCC,QAAmB,IAAVA,OAA6B,IAAVA,MACjC5B,EAASgB,OAAOa,aAAa7B,EAAS8B,cAAeF,OAErD5B,EAASgB,OAAOe,gBAAgB/B,EAAS8B,eAK3CrC,EAAMQ,QAAQC,UAAUC,QAAQ,uBAGjCI,KAAO,WACFH,KAAKP,WAAa,GACpBO,KAAKE,QAAQF,KAAKR,UAAUQ,KAAKP,cAAc,IAIlDmC,KAAO,WACF5B,KAAKP,UAAYO,KAAKR,UAAUqC,OAAS,GAC3C7B,KAAKE,QAAQF,KAAKR,YAAYQ,KAAKP,YAAY,IAIlDqC,WAAa,WACZ,OAAO9B,KAAKR,UAAUqC","file":"../Undo.js","sourcesContent":["define([\n\t\"./Vvveb\"\n],function(Vvveb){\n\n\treturn Vvveb.Undo = {\n\t\t\n\t\tundos: [],\n\t\tmutations: [],\n\t\tundoIndex: -1,\n\t\tenabled:true,\n\t\t/*\t\t\n\t\tinit: function() {\n\t\t},\n\t\t*/\t\n\t\taddMutation : function(mutation) {\t\n\t\t\t/*\n\t\t\t\tthis.mutations.push(mutation);\n\t\t\t\tthis.undoIndex++;\n\t\t\t*/\n\t\t\tVvveb.Builder.frameBody.trigger(\"vvveb.undo.add\");\n\t\t\tthis.mutations.splice(++this.undoIndex, 0, mutation);\n\t\t },\n\n\t\trestore : function(mutation, undo) {\t\n\t\t\t\n\t\t\tswitch (mutation.type) {\n\t\t\t\tcase 'childList':\n\t\t\t\t\n\t\t\t\t\tif (undo == true)\n\t\t\t\t\t{\n\t\t\t\t\t\taddedNodes = mutation.removedNodes;\n\t\t\t\t\t\tremovedNodes = mutation.addedNodes;\n\t\t\t\t\t} else //redo\n\t\t\t\t\t{\n\t\t\t\t\t\taddedNodes = mutation.addedNodes;\n\t\t\t\t\t\tremovedNodes = mutation.removedNodes;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (addedNodes) for(i in addedNodes)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = addedNodes[i];\n\t\t\t\t\t\tif (mutation.nextSibling)\n\t\t\t\t\t\t{ \n\t\t\t\t\t\t\tmutation.nextSibling.parentNode.insertBefore(node, mutation.nextSibling);\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmutation.target.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (removedNodes) for(i in removedNodes)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = removedNodes[i];\n\t\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t\t}\n\t\t\t\tbreak;\t\t\t\t\t\n\t\t\t\tcase 'move':\n\t\t\t\t\tif (undo == true)\n\t\t\t\t\t{\n\t\t\t\t\t\tparent = mutation.oldParent;\n\t\t\t\t\t\tsibling = mutation.oldNextSibling;\n\t\t\t\t\t} else //redo\n\t\t\t\t\t{\n\t\t\t\t\t\tparent = mutation.newParent;\n\t\t\t\t\t\tsibling = mutation.newNextSibling;\n\t\t\t\t\t}\n\t\t\t\t  \n\t\t\t\t\tif (sibling)\n\t\t\t\t\t{\n\t\t\t\t\t\tsibling.parentNode.insertBefore(mutation.target, sibling);\n\t\t\t\t\t} else\n\t\t\t\t\t{\n\t\t\t\t\t\tparent.append(node);\n\t\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t\tcase 'characterData':\n\t\t\t\t  mutation.target.innerHTML = undo ? mutation.oldValue : mutation.newValue;\n\t\t\t\t  break;\n\t\t\t\tcase 'attributes':\n\t\t\t\t  value = undo ? mutation.oldValue : mutation.newValue;\n\n\t\t\t\t  if (value || value === false || value === 0)\n\t\t\t\t\tmutation.target.setAttribute(mutation.attributeName, value);\n\t\t\t\t  else\n\t\t\t\t\tmutation.target.removeAttribute(mutation.attributeName);\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tVvveb.Builder.frameBody.trigger(\"vvveb.undo.restore\");\n\t\t },\n\t\t \n\t\tundo : function() {\t\n\t\t\tif (this.undoIndex >= 0) {\n\t\t\t  this.restore(this.mutations[this.undoIndex--], true);\n\t\t\t}\n\t\t },\n\n\t\tredo : function() {\t\n\t\t\tif (this.undoIndex < this.mutations.length - 1) {\n\t\t\t  this.restore(this.mutations[++this.undoIndex], false);\n\t\t\t}\n\t\t},\n\n\t\thasChanges : function() {\t\n\t\t\treturn this.mutations.length;\n\t\t},\n\t};\n\n});\n"]}