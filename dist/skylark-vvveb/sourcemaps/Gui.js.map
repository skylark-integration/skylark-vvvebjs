{"version":3,"sources":["Gui.js"],"names":["define","$","Vvveb","Gui","init","each","on","this","dataset","vvvebOn","vvvebAction","vvvebShortcut","document","window","FrameDocument","FrameWindow","undo","WysiwygEditor","isActive","Undo","Builder","selectNode","redo","save","val","getHtml","modal","saveAjax","url","FileManager","getCurrentUrl","data","find","html","download","filename","exec","iframe","src","uriContent","encodeURIComponent","link","createElement","href","target","body","appendChild","result","click","removeChild","remove","location","viewport","attr","view","toggleEditor","toggleClass","toggle","CodeEditor","toggleEditorJsExecute","runJsOnSetHtml","checked","preview","isPreview","fullscreen","launchFullScreen","componentSearch","searchText","value","$this","hide","indexOf","show","clearComponentSearch","keyup","blockSearch","clearBlockSearch","addBoxComponentSearch","addBoxBlockSearch","newPage","newPageModal","off","submit","event","title","startTemplateUrl","fileName","name","replace","toLowerCase","addPage","preventDefault","loadPage","scrollBottom","deletePage","setDesignerMode","designerMode","attributes"],"mappings":"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","file":"../Gui.js","sourcesContent":["define([\n\t\"skylark-utils-dom/query\",\n\t\"./Vvveb\",\n\t\"./Builder\",\n\t\"./WysiwygEditor\",\n\t\"skylark-bootstrap4/modal\"\n],function($,Vvveb){\n\tvar Gui = {\n\t\t\n\t\tinit: function() {\n\t\t\t$(\"[data-vvveb-action]\").each(function () {\n\t\t\t\ton = \"click\";\n\t\t\t\tif (this.dataset.vvvebOn) on = this.dataset.vvvebOn;\n\t\t\t\t\n\t\t\t\t$(this).on(on, Vvveb.Gui[this.dataset.vvvebAction]);\n\t\t\t\tif (this.dataset.vvvebShortcut)\n\t\t\t\t{\n\t\t\t\t\t$(document).on('keydown', this.dataset.vvvebShortcut, Vvveb.Gui[this.dataset.vvvebAction]);\n\t\t\t\t\t$(window.FrameDocument, window.FrameWindow).on('keydown', this.dataset.vvvebShortcut, Vvveb.Gui[this.dataset.vvvebAction]);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\tundo : function () {\n\t\t\tif (Vvveb.WysiwygEditor.isActive) \n\t\t\t{\n\t\t\t\tVvveb.WysiwygEditor.undo();\n\t\t\t} else\n\t\t\t{\n\t\t\t\tVvveb.Undo.undo();\n\t\t\t}\n\t\t\tVvveb.Builder.selectNode();\n\t\t},\n\t\t\n\t\tredo : function () {\n\t\t\tif (Vvveb.WysiwygEditor.isActive) \n\t\t\t{\n\t\t\t\tVvveb.WysiwygEditor.redo();\n\t\t\t} else\n\t\t\t{\n\t\t\t\tVvveb.Undo.redo();\n\t\t\t}\n\t\t\tVvveb.Builder.selectNode();\n\t\t},\n\t\t\n\t\t//show modal with html content\n\t\tsave : function () {\n\t\t\t$('#textarea-modal textarea').val(Vvveb.Builder.getHtml());\n\t\t\t$('#textarea-modal').modal();\n\t\t},\n\t\t\n\t\t//post html content through ajax to save to filesystem/db\n\t\tsaveAjax : function () {\n\t\t\t\n\t\t\tvar url = Vvveb.FileManager.getCurrentUrl();\n\t\t\t\n\t\t\treturn Vvveb.Builder.saveAjax(url, null, function (data) {\n\t\t\t\t$('#message-modal').modal().find(\".modal-body\").html(\"File saved at: \" + data);\n\t\t\t});\t\t\n\t\t},\n\t\t\n\t\tdownload : function () {\n\t\t\tfilename = /[^\\/]+$/.exec(Vvveb.Builder.iframe.src)[0];\n\t\t\turiContent = \"data:application/octet-stream,\"  + encodeURIComponent(Vvveb.Builder.getHtml());\n\n\t\t\tvar link = document.createElement('a');\n\t\t\tif ('download' in link)\n\t\t\t{\n\t\t\t\tlink.download = filename;\n\t\t\t\tlink.href = uriContent;\n\t\t\t\tlink.target = \"_blank\";\n\t\t\t\t\n\t\t\t\tdocument.body.appendChild(link);\n\t\t\t\tresult = link.click();\n\t\t\t\tdocument.body.removeChild(link);\n\t\t\t\tlink.remove();\n\t\t\t\t\n\t\t\t} else\n\t\t\t{\n\t\t\t\tlocation.href = uriContent;\n\t\t\t}\n\t\t},\n\t\t\n\t\tviewport : function () {\n\t\t\t$(\"#canvas\").attr(\"class\", this.dataset.view);\n\t\t},\n\t\t\n\t\ttoggleEditor : function () {\n\t\t\t$(\"#vvveb-builder\").toggleClass(\"bottom-panel-expand\");\n\t\t\t$(\"#toggleEditorJsExecute\").toggle();\n\t\t\tVvveb.CodeEditor.toggle();\n\t\t},\n\t\t\n\t\ttoggleEditorJsExecute : function () {\n\t\t\tVvveb.Builder.runJsOnSetHtml = this.checked;\n\t\t},\n\t\t\n\t\tpreview : function () {\n\t\t\t(Vvveb.Builder.isPreview == true)?Vvveb.Builder.isPreview = false:Vvveb.Builder.isPreview = true;\n\t\t\t$(\"#iframe-layer\").toggle();\n\t\t\t$(\"#vvveb-builder\").toggleClass(\"preview\");\n\t\t},\n\t\t\n\t\tfullscreen : function () {\n\t\t\tVvveb.launchFullScreen(document); // the whole page\n\t\t},\n\t\t\n\t\tcomponentSearch : function () {\n\t\t\tsearchText = this.value;\n\t\t\t\n\t\t\t$(\"#left-panel .components-list li ol li\").each(function () {\n\t\t\t\t$this = $(this);\n\t\t\t\t\n\t\t\t\t$this.hide();\n\t\t\t\tif ($this.data(\"search\").indexOf(searchText) > -1) $this.show();\n\t\t\t});\n\t\t},\n\t\t\n\t\tclearComponentSearch : function () {\n\t\t\t$(\".component-search\").val(\"\").keyup();\n\t\t},\n\t\t\n\t\tblockSearch : function () {\n\t\t\tsearchText = this.value;\n\t\t\t\n\t\t\t$(\"#left-panel .blocks-list li ol li\").each(function () {\n\t\t\t\t$this = $(this);\n\t\t\t\t\n\t\t\t\t$this.hide();\n\t\t\t\tif ($this.data(\"search\").indexOf(searchText) > -1) $this.show();\n\t\t\t});\n\t\t},\n\t\t\n\t\tclearBlockSearch : function () {\n\t\t\t$(\".block-search\").val(\"\").keyup();\n\t\t},\n\t\t\n\t\taddBoxComponentSearch : function () {\n\t\t\tsearchText = this.value;\n\t\t\t\n\t\t\t$(\"#add-section-box .components-list li ol li\").each(function () {\n\t\t\t\t$this = $(this);\n\t\t\t\t\n\t\t\t\t$this.hide();\n\t\t\t\tif ($this.data(\"search\").indexOf(searchText) > -1) $this.show();\n\t\t\t});\n\t\t},\n\t\t\n\t\t\n\t\taddBoxBlockSearch : function () {\n\t\t\tsearchText = this.value;\n\t\t\t\n\t\t\t$(\"#add-section-box .blocks-list li ol li\").each(function () {\n\t\t\t\t$this = $(this);\n\t\t\t\t\n\t\t\t\t$this.hide();\n\t\t\t\tif ($this.data(\"search\").indexOf(searchText) > -1) $this.show();\n\t\t\t});\n\t\t},\n\n\t\n\t\tnewPage : function () { //Pages, file/components tree \n\t\t\t\n\t\t\tvar newPageModal = $('#new-page-modal');\n\t\t\t\n\t\t\tnewPageModal.modal(\"show\").find(\"form\").off(\"submit\").submit(function( event ) {\n\n\t\t\t\tvar title = $(\"input[name=title]\", newPageModal).val();\n\t\t\t\tvar startTemplateUrl = $(\"select[name=startTemplateUrl]\", newPageModal).val();\n\t\t\t\tvar fileName = $(\"input[name=fileName]\", newPageModal).val();\n\t\t\t\t\n\t\t\t\t//replace nonalphanumeric with dashes and lowercase for name\n\t\t\t\tvar name = title.replace(/\\W+/g, '-').toLowerCase();\n\t\t\t\t\t//allow only alphanumeric, dot char for extension (eg .html) and / to allow typing full path including folders\n\t\t\t\t\tfileName = fileName.replace(/[^A-Za-z0-9\\.\\/]+/g, '-').toLowerCase();\n\t\t\t\t\n\t\t\t\t//add your server url/prefix/path if needed\n\t\t\t\tvar url = \"\" + fileName;\n\t\t\t\t\n\n\t\t\t\tVvveb.FileManager.addPage(name, title, url);\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn Vvveb.Builder.saveAjax(url, startTemplateUrl, function (data) {\n\t\t\t\t\t\tVvveb.FileManager.loadPage(name);\n\t\t\t\t\t\tVvveb.FileManager.scrollBottom();\n\t\t\t\t\t\tnewPageModal.modal(\"hide\");\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t},\n\t\t\n\t\tdeletePage : function () {\n\t\t\t\n\t\t},\n\n\t\tsetDesignerMode : function () {\n\t\t\t//aria-pressed attribute is updated after action is called and we check for false instead of true\n\t\t\tvar designerMode = this.attributes[\"aria-pressed\"].value != \"true\";\n\t\t\tVvveb.Builder.setDesignerMode(designerMode);\n\t\t}\n\t\t\n\t}\n\n\treturn Vvveb.Gui = Gui;\n});\n\n\n"]}