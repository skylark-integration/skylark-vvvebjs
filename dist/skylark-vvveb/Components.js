/**
 * skylark-vvveb - A version of Vvveb.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-vvveb/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/query","./Vvveb","./tmpl","./inputs"],function(t,e,i,s,r){var a=e;return i.Components={base_sort:100,_components:{},_nodesLookup:{},_attributesLookup:{},_classesLookup:{},_classesRegexLookup:{},componentPropertiesElement:"#right-panel .component-properties",get:function(t){return this._components[t]},add:function(t,e){if(e.type=t,this._components[t]=e,e.nodes)for(var i in e.nodes)this._nodesLookup[e.nodes[i]]=e;if(e.attributes)if(e.attributes.constructor===Array)for(var i in e.attributes)this._attributesLookup[e.attributes[i]]=e;else for(var i in e.attributes)void 0===this._attributesLookup[i]&&(this._attributesLookup[i]={}),void 0===this._attributesLookup[i][e.attributes[i]]&&(this._attributesLookup[i][e.attributes[i]]={}),this._attributesLookup[i][e.attributes[i]]=e;if(e.classes)for(var i in e.classes)this._classesLookup[e.classes[i]]=e;if(e.classesRegex)for(var i in e.classesRegex)this._classesRegexLookup[e.classesRegex[i]]=e},extend:function(e,i,s){var r=s;(inheritData=this._components[e])&&((r=t.extend(!0,{},inheritData,s)).properties=t.merge(t.merge([],inheritData.properties?inheritData.properties:[]),s.properties?s.properties:[])),r.properties.sort(function(t,e){return void 0===t.sort&&(t.sort=0),void 0===e.sort&&(e.sort=0),t.sort<e.sort?-1:t.sort>e.sort?1:0}),this.add(i,r)},matchNode:function(t){var e={};if(!t||!t.tagName)return!1;if(t.attributes&&t.attributes.length){for(var i in t.attributes)if(t.attributes[i]&&(attr=t.attributes[i].name,value=t.attributes[i].value,attr in this._attributesLookup)){if(void 0!==(e=this._attributesLookup[attr]).name)return e;if(value in e)return e[value]}for(var i in t.attributes)if(attr=t.attributes[i].name,value=t.attributes[i].value,"class"==attr){for(j in classes=value.split(" "),classes)if(classes[j]in this._classesLookup)return this._classesLookup[classes[j]];for(regex in this._classesRegexLookup)if(regexObj=new RegExp(regex),regexObj.exec(value))return this._classesRegexLookup[regex]}}return tagName=t.tagName.toLowerCase(),tagName in this._nodesLookup&&this._nodesLookup[tagName]},render:function(t){var n=this._components[t],o=a(this.componentPropertiesElement),u=o.find('.section[data-section="default"]');i.preservePropertySections&&u.length||(o.html("").append(s("vvveb-input-sectioninput",{key:"default",header:n.name})),u=o.find(".section")),o.find('[data-header="default"] span').html(n.name),u.html(""),n.beforeInit&&n.beforeInit(i.Builder.selectedEl.get(0));var l=function(t,e){return e.input.on("propertyChange",function(s,r,a){var n=i.Builder.selectedEl;return e.child&&(n=n.find(e.child)),e.parent&&(n=n.parent(e.parent)),e.onChange&&(n=e.onChange(n,r,a,t)),e.htmlAttr&&(oldValue=n.attr(e.htmlAttr),"class"==e.htmlAttr&&e.validValues?(n.removeClass(e.validValues.join(" ")),n=n.addClass(r)):n="style"==e.htmlAttr?n.css(e.key,r):n.attr(e.htmlAttr,r),i.Undo.addMutation({type:"attributes",target:n.get(0),attributeName:e.htmlAttr,oldValue:oldValue,newValue:n.attr(e.htmlAttr)})),t.onChange&&(n=t.onChange(n,e,r,a)),e.child||e.parent||i.Builder.selectNode(n),n})},p=i.Builder.selectedEl;for(var d in n.properties){var c=n.properties[d],h=p;if(c.beforeInit&&c.beforeInit(h.get(0)),c.child&&(h=h.find(c.child)),c.data?c.data.key=c.key:c.data={key:c.key},void 0===c.group&&(c.group=null),c.input=c.inputtype.init(c.data),c.init)c.inputtype.setValue(c.init(h.get(0)));else if(c.htmlAttr){if("style"==c.htmlAttr)var f=i.getStyle(h.get(0),c.key);else f=h.attr(c.htmlAttr);f&&"class"==c.htmlAttr&&c.validValues&&(f=f.split(" ").filter(function(t){return-1!=c.validValues.indexOf(t)})),c.inputtype.setValue(f)}if(l(n,c),c.inputtype==r.SectionInput)u=o.find('.section[data-section="'+c.key+'"]'),i.preservePropertySections&&u.length?u.html(""):(o.append(c.input),u=o.find('.section[data-section="'+c.key+'"]'));else{var v=e(s("vvveb-property",c));v.find(".input").append(c.input),u.append(v)}c.inputtype.afterInit&&c.inputtype.afterInit(c.input)}n.init&&n.init(i.Builder.selectedEl.get(0))}}});
//# sourceMappingURL=sourcemaps/Components.js.map
