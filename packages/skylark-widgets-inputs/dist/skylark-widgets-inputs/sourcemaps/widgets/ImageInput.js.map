{"version":3,"sources":["widgets/ImageInput.js"],"names":["define","langx","$","inputs","Input","tmpl","ImageInput","inherit","events","setValue","value","indexOf","this","element","val","onUpload","event","node","files","reader","FileReader","onload","e","image","target","result","data","trigger","formData","FormData","append","file","ajax","type","url","processData","contentType","success","console","log","error","alert","responseText","readAsDataURL","init","render"],"mappings":";;;;;;;AAAAA,QACC,sBACA,0BACA,YACA,UACA,UACC,SAASC,EAAOC,EAAEC,EAAOC,EAAMC,GAEhC,IAAIC,EAAaF,EAAMG,SAEnBC,SACK,OAAQ,WAAY,qBACpB,SAAU,WAAY,qBAG9BC,SAAU,SAASC,IAGkB,GAAhCA,EAAMC,QAAQ,eAEhBT,EAAE,qBAAsBU,KAAKC,SAASC,IAAIJ,IAI7CK,SAAU,SAASC,EAAOC,GAEzB,GAAIL,KAAKM,OAASN,KAAKM,MAAM,GAAI,CACvB,IAAIC,EAAS,IAAIC,WACjBD,EAAOE,OAMjB,SAAuBC,GAErBC,MAAQD,EAAEE,OAAOC,OAEjBT,EAAMU,KAAKb,QAAQc,QAAQ,kBAAmBJ,MAAOX,OAIrD,IAAIgB,EAAW,IAAIC,SACnBD,EAASE,OAAO,OAAQC,MAExB7B,EAAE8B,MACDC,KAAM,OACNC,IAAK,aACLR,KAAME,EACNO,aAAa,EACbC,aAAa,EACbC,QAAS,SAAUX,GAClBY,QAAQC,IAAI,qBAAsBb,GAGlCV,EAAMU,KAAKb,QAAQc,QAAQ,kBAAmBD,EAAMd,OAGpDV,EAAE,qBAAsBc,EAAMU,KAAKb,SAASC,IAAIY,IAEjDc,MAAO,SAAUd,GAChBe,MAAMf,EAAKgB,kBAhCLvB,EAAOwB,cAAc/B,KAAKM,MAAM,IAEhCa,KAAOnB,KAAKM,MAAM,KAoC7B0B,KAAM,SAASlB,GACd,OAAOd,KAAKiC,OAAO,aAAcnB,MAKnC,OAAOvB,EAAOG,WAAaA","file":"../../widgets/ImageInput.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-utils-dom/query\",\r\n\t\"../inputs\",\r\n\t\"./Input\",\r\n\t\"./tmpl\"\r\n],function(langx, $,inputs,Input,tmpl) {\r\n\r\n\tvar ImageInput = Input.inherit({\r\n\r\n\t    events: [\r\n\t        [\"blur\", \"onChange\", \"input[type=text]\"],\r\n\t        [\"change\", \"onUpload\", \"input[type=file]\"],\r\n\t\t ],\r\n\r\n\t\tsetValue: function(value) {\r\n\r\n\t\t\t//don't set blob value to avoid slowing down the page\t\t\r\n\t\t\tif (value.indexOf(\"data:image\") == -1)\r\n\t\t\t{\r\n\t\t\t\t\t$('input[type=\"text\"]', this.element).val(value);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonUpload: function(event, node) {\r\n\r\n\t\t\tif (this.files && this.files[0]) {\r\n\t            var reader = new FileReader();\r\n\t            reader.onload = imageIsLoaded;\r\n\t            reader.readAsDataURL(this.files[0]);\r\n\t            //reader.readAsBinaryString(this.files[0]);\r\n\t            file = this.files[0];\r\n\t        }\r\n\r\n\t\t\tfunction imageIsLoaded(e) {\r\n\t\t\t\t\t\r\n\t\t\t\t\timage = e.target.result;\r\n\t\t\t\t\t\r\n\t\t\t\t\tevent.data.element.trigger('propertyChange', [image, this]);\r\n\t\t\t\t\t\r\n\t\t\t\t\t//return;//remove this line to enable php upload\r\n\r\n\t\t\t\t\tvar formData = new FormData();\r\n\t\t\t\t\tformData.append(\"file\", file);\r\n\t    \r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\turl: 'upload.php',//set your server side upload script url\r\n\t\t\t\t\t\tdata: formData,\r\n\t\t\t\t\t\tprocessData: false,\r\n\t\t\t\t\t\tcontentType: false,\r\n\t\t\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\t\t\tconsole.log(\"File uploaded at: \", data);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//if image is succesfully uploaded set image url\r\n\t\t\t\t\t\t\tevent.data.element.trigger('propertyChange', [data, this]);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//update src input\r\n\t\t\t\t\t\t\t$('input[type=\"text\"]', event.data.element).val(data);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (data) {\r\n\t\t\t\t\t\t\talert(data.responseText);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\t\t\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinit: function(data) {\r\n\t\t\treturn this.render(\"imageinput\", data);\r\n\t\t}\t\r\n\r\n\t});\r\n\r\n\treturn inputs.ImageInput = ImageInput;\r\n});"]}